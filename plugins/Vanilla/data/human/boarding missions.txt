# Copyright (c) 2015 by Michael Zahniser
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.

conversation "assisting merchant"
	`${assist merchant 1} <origin>${assist merchant 2} ${assist merchant 3} <payment>${assist merchant 4}`
		decline

conversation "assisting merchant hazardous"
	`${assist merchant 1 hazardous} <origin>${assist merchant 2} ${assist merchant 3} <payment>${assist merchant 4}`
		decline

mission "Assisting Merchant (Small)"
	assisting
	repeat
	minor
	to offer
		random < 20
	source
		government "Merchant"
		category "Interceptor" "Light Warship" "Transport" "Light Freighter"
		not attributes "automaton"
	on offer
		payment 10000
		conversation "assisting merchant"
	# A mission with no destination will not be offered, so give it one.
	# What the destination is doesn't matter, because you always 'decline' this.
	destination "Earth"

mission "Assisting Merchant (Medium)"
	assisting
	repeat
	minor
	to offer
		random < 15
	source
		government "Merchant"
		category "Medium Warship" "Heavy Freighter"
		not attributes "automaton"
	on offer
		payment 20000
		conversation "assisting merchant"
	destination "Earth"

mission "Assisting Merchant (Large)"
	assisting
	repeat
	minor
	to offer
		random < 10
	source
		government "Merchant"
		category "Heavy Warship"
		not attributes "automaton"
	on offer
		payment 30000
		conversation "assisting merchant"
	destination "Earth"

phrase "assist merchant 1"
	phrase
		"assist merchant 1-1"
	phrase
		"assist merchant 1-2"
	phrase
		"assist merchant 1-3"

phrase "assist merchant 1 hazardous"
	phrase
		"assist merchant 1-1"
	phrase
		"assist merchant 1-2 hazardous"
	phrase
		"assist merchant 1-3"

phrase "assist merchant 1-1"
	word
		`Knowing that `
		`Since `
		`Understanding that `
		`Considering that `
		`Seeing how `
		`Knowing how `

phrase "assist merchant 1-2"
	word
		`you altered course `
		`you went out of your way `
		`you may have altered your own flight plans `

phrase "assist merchant 1-2 hazardous"
	word
		`you risked your life `
		`you risked your ship `
		`you risked your own ship `
		`you braved enemy fire `
		`you braved danger `

phrase "assist merchant 1-3"
	word
		`to ` 4
		`in order to ` 2
		`so that you could `
	word
		`save `
		`repair `
		`rescue `
		`secure `
		`assist `
		`help `
	word
		`the`

phrase "assist merchant 2"
	phrase
		`assist merchant 2 simple` 2
		`assist merchant 2 complex`

phrase "assist merchant 2 simple"
	word
		`, `

phrase "assist merchant 2 complex"
	word
		` and `
	word
		`save its cargo, `
		`secure its cargo, `
		`save its crew, `
		`rescue its crew, `

phrase "assist merchant 3"
	word
		`its `
		`the `
		`the ship's `
		`the vessel's `
	word
		`` 4
		`relieved `
	word
		`captain `
	word
		`gives you`
		`offers you`
		`rewards you with`

phrase "assist merchant 4"
	word
		`.` 5
		` in gratitude.`
		` in appreciation.`
		` as an expression of their gratitude.`
		` in thanks.`
		` as thanks.`
		` for your assistance.`



mission "Asteroid Course"
	assisting
	minor
	name "Passengers to <planet>"
	description "Transport the remaining crew of a destroyed ship, <bunks> people that were working on the <origin>, to <destination>."
	to offer
		random < 6
	source
		government "Merchant" "Syndicate"
		category "Light Freighter" "Interceptor"
		not attributes "automaton"
	passengers 3 7
	destination
		distance 1 3
		not government "Pirate"
		attributes shipyard
	on offer
		conversation
			`As you are approaching the <origin>, your radar sensors detect that the ship you are assisting is about to be slammed by a huge asteroid! While in a normal flight this wouldn't cause much trouble, a ship that has already suffered heavy damage and cannot dodge could be completely destroyed.`
			branch unarmed
				not "armament deterrence"
			choice
				`	(Shoot the asteroid.)`
					goto fire
				`	(Maneuver my ship to shield the <origin>.)`
					goto move
				`	(Attempt to repair the <origin> so that it can dodge the asteroid.)`
					goto repair
				`	(Interrupt the docking maneuvers and fly away.)`
					goto escape
			label unarmed
			choice
				`	(Maneuver my ship to shield the <origin>.)`
					goto move
				`	(Attempt to repair the <origin> so that it can dodge the asteroid.)`
					goto repair
				`	(Interrupt the docking maneuvers and fly away.)`
			label escape
			`	You turn your ship around and activate your thrusters, trying to get as far as you can from the disabled ship. A few seconds later, the asteroid collides with the <origin>, tearing it to shreds and killing all of its crew members while leaving little more than a scratch on the asteroid's surface.`
				depart
			label fire
			branch success
				random < 50
			`	You fire at the asteroid in an attempt to destroy it, but it looks like you've only made things worse. The asteroid has now broken up into dozens of smaller chunks still flying directly for the <origin>. Before you can even react to fix your mistake, most of the chunks have already hit the <origin>, which is now quickly depressurizing. There's nothing more you can do except move a safe distance away from the exploding ship...`
				depart
			label success
			`	The shots you fire quickly break the asteroid into pieces, which seem to have changed course enough to completely miss the <origin>. After repairing it, you hail its captain, who thanks you with a payment of 30,000 credits.`
				decline
			label repair
			branch crew
				random < 40
			`	You dock with the <origin>, hoping to get out of this alive, but as soon as you reach the hatch, the asteroid hits and a series of explosions start coming from the disabled ship. You are able to reach your cockpit and undock, but the crew on the other ship couldn't reach yours in time...`
				depart
			label crew
			`	You dock with the <origin>, hoping to get out of this alive, but, as soon as you reach the hatch, the asteroid hits and a series of explosions start coming from the disabled ship. Most of the other ship's crew has been able to reach your ship by the time you undock from it, and they ask you to take them to <destination>.`
			choice
				`	"Okay, it's not far."`
					launch
				`	"How much can you pay me?"`
			`	"I have a few hundred thousand credits," one of them says, presumably the captain. "I need to save enough to buy a new starship, but you will still receive a decent pay."`
				launch
			label move
			`	The asteroid, after hitting your shield, breaks into a million fragments which fly away from the <origin>. After repairing it, you hail its captain, who thanks you with a payment of 30,000 credits.`
				decline
	on decline
		payment 30000
	on complete
		payment
		payment 35000
		dialog "The captain you talked with before thanks you again for saving him and his crew, and hands you <payment>."



mission "Dangerous Journey"
	assisting
	minor
	name "Delivery to <planet>"
	description "Deliver <cargo> to <destination>. Payment is <payment>."
	to offer
		random < 10
	source
		government "Merchant"
		category "Light Freighter" "Heavy Freighter"
		not attributes "automaton"
	destination
		government "Republic" "Syndicate" "Free Worlds"
		attributes "frontier"
		distance 2 3
	cargo random 5 2 .1
	on offer
		conversation
			`When you repair the <origin>, the captain hails you. "This is the fourth time I've nearly died in the past week doing this job! Here, take this <cargo> to <destination> and finish this job for me. They said the payment is <payment>."`
			choice
				`	(Take the cargo.)`
					accept
				`	(Don't take the cargo.)`
			`	The captain begins loudly swearing, so you cut the feed. Hopefully they make it to their destination in one piece.`
				decline
	on complete
		payment 7500
		dialog `You drop off your cargo of <commodity>, explain how the original merchant who took the job quit and handed off the cargo to you, and collect your payment of <payment>.`



conversation "assisting law enforcement"
	`The captain of the <origin> thanks you for repairing them, but informs you that the pirates that disabled them are only a smaller part of a fleet attacking <destination>.`
	`	The authorities of <planet> will probably pay you quite well if you assist them, but this could also be an easy way to get yourself killed.`
	choice
		`	(Don't join the fight.)`
			decline
		`	(Join the defense fleet.)`
			accept

mission "Assisting Free Worlds"
	assisting
	repeat
	minor
	name "Defend <planet>"
	description "Defeat a pirate raid on <destination>."
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Free Worlds"
		not category "Fighter" "Drone"
		not attributes "automaton"
	destination
		government "Free Worlds"
		distance 2 4
	on offer
		conversation "assisting law enforcement"
	npc kill
		government "Pirate"
		personality heroic staying target harvests plunders
		system destination
		fleet "Large Southern Pirates" 2
		fleet "Small Southern Pirates"
	npc
		government "Free Worlds"
		personality heroic staying
		system destination
		fleet "Large Free Worlds"
	on complete
		payment 150000
		dialog phrase "generic pirate attack payment dialog"

mission "Assisting Republic"
	assisting
	repeat
	minor
	name "Defend <planet>"
	description "Defeat a pirate raid on <destination>."
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Republic"
		not category "Fighter" "Drone"
		not attributes "automaton"
	destination
		government "Republic"
		distance 2 4
	on offer
		conversation "assisting law enforcement"
	npc kill
		government "Pirate"
		personality heroic staying target harvests plunders
		system destination
		fleet "Large Northern Pirates" 2
		fleet "Small Northern Pirates"
	npc
		government "Republic"
		personality heroic staying
		system destination
		fleet "Small Republic" 2
	on complete
		payment 150000
		dialog phrase "generic pirate attack payment dialog"

mission "Assisting Deep Security"
	assisting
	repeat
	minor
	name "Defend <planet>"
	description "Defeat a pirate raid on <destination>."
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Deep Security"
		not category "Fighter" "Drone"
		not attributes "automaton"
	destination
		attributes "deep"
		distance 2 4
	on offer
		conversation "assisting law enforcement"
	npc kill
		government "Pirate"
		personality heroic staying target harvests plunders
		system destination
		fleet "Large Northern Pirates" 2
		fleet "Small Northern Pirates"
	npc
		government "Deep Security"
		personality heroic staying
		system destination
		fleet "Large Deep Security"
	on complete
		payment 150000
		dialog phrase "generic pirate attack payment dialog"

mission "Assisting Syndicate"
	assisting
	repeat
	minor
	name "Defend <planet>"
	description "Defeat a pirate raid on <destination>."
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Syndicate"
		not category "Fighter" "Drone"
		not attributes "automaton"
	destination
		government "Syndicate"
		distance 2 4
	on offer
		conversation "assisting law enforcement"
	npc kill
		government "Pirate"
		personality heroic staying target harvests plunders
		system destination
		fleet "Large Core Pirates" 2
		fleet "Small Core Pirates"
	npc
		government "Syndicate"
		personality heroic staying
		system destination
		fleet "Large Syndicate"
	on complete
		payment 150000
		dialog phrase "generic pirate attack payment dialog"



conversation "boarding pirate"
	`You make short-range scans of the <origin>'s outfits and cargo. Among the cargo, you find a crate full of credit chips worth <payment>. You drag the crate onto your ship before considering your next move.`
		decline

mission "Boarding Pirate (Small)"
	boarding
	repeat
	minor
	to offer
		random < 7
	source
		government "Pirate"
		category "Interceptor" "Light Warship" "Transport" "Light Freighter"
	on offer
		payment 50000
		conversation "boarding pirate"
	destination "Earth"

mission "Boarding Pirate (Medium)"
	boarding
	repeat
	minor
	to offer
		random < 5
	source
		government "Pirate"
		category "Medium Warship" "Heavy Freighter"
	on offer
		payment 100000
		conversation "boarding pirate"
	destination "Earth"

mission "Boarding Pirate (Large)"
	boarding
	repeat
	minor
	to offer
		random < 3
	source
		government "Pirate"
		category "Heavy Warship"
	on offer
		payment 150000
		conversation "boarding pirate"
	destination "Earth"



mission "Pirate Ambush"
	invisible
	boarding
	repeat
	minor
	deadline 1
	to offer
		"combat rating" > 100
		random < 5
	source
		government "Pirate"
		category "Interceptor" "Light Warship" "Transport" "Light Freighter"
		not attributes "automaton"
	on offer
		conversation
			`You board the <origin>, but find no crew aboard. When you reach the cockpit of the ship, you look out into space to see an escape pod floating away. The <origin> is emitting a distress signal to nearby pirates, and a self-destruct sequence has been activated! You run back to your ship and get ready to fight.`
				launch
	destination "Earth"
	npc kill
		government "Pirate"
		personality nemesis harvests plunders entering
		fleet "pirate raid" 2



mission "Pirate Mutiny"
	boarding
	minor
	description "Bring <bunks> ex-pirate crew members to <destination>."
	to offer
		random < 10
	source
		government "Pirate"
		category "Medium Warship" "Heavy Warship"
		not attributes "automaton"
	destination
		government "Republic" "Free Worlds" "Syndicate" "Neutral" "Independent"
		distance 2 4
	passengers 10 20
	on offer
		conversation
			`When you board the <origin>, you find most of the crew already dead. One of the surviving crew members, who looks like a teenaged boy no older than 16, approaches you with his hands in the air. He explains that after the ship was disabled, a section of the crew decided to overthrow the tyrannical captain. He continues, saying how most pirate crew members are forced into servitude on pirate ships. The surviving <bunks> crew members beg you to bring them to <destination> so that they can escape from pirate slavery.`
			`	The fight seems to have damaged the ship beyond repair. It may not last much longer in the vacuum of space if you leave the pirates here.`
			choice
				`	(Help the pirate crew.)`
					launch
				`	(Leave the pirate crew.)`
					flee
	on complete
		payment 25000
		dialog `The pirate crew members thank you for bringing them to <planet>. One of them hands you a small payment of <payment>. You wish them all the best of luck with their new lives and part ways.`



mission "Slave Crew Rescue"
	invisible
	assisting
	deadline 1
	passengers 1
	to offer
		random < 10
	source
		government "Merchant"
		category "Heavy Freighter"
		not attributes "automaton"
	destination "Earth"
	on offer
		conversation
			branch "boarding alone" "boarding with a big boarding party"
				"flagship crew" < 3

			label "boarding alone"
			branch "flagship is empty" "first mate left on flagship"
				"flagship crew" == 1

			label "flagship is empty"
			`You leave your ship empty and board the <origin> alone. Though you aren't expecting any danger, you still feel apprehensive all by yourself on an unknown disabled vessel, so you make sure to bring a sidearm. Your apprehension rises as you realize you can't hear any sounds of frantic activity or see crew members scurrying around trying to repair damage like you would expect. Making your way to the bridge, you relax upon seeing a single handsome and well-dressed young man welding a bulkhead. His movements are dexterous and competent, but your practiced eye tells you that the bulkhead is damaged beyond repair, so his work is futile. He looks up and introduces himself as captain Tarquin, offering the princely sum of 350,000 credits for your expert help repairing his vessel.`
				goto "first decision"

			label "first mate left on flagship"
			`You leave your first mate in charge of your ship and board the <origin> alone. Though you aren't expecting any danger, you still feel apprehensive all by yourself on an unknown disabled vessel, so you make sure to bring a sidearm. Your apprehension rises as you realize you can't hear any sounds of frantic activity or see crew members scurrying around trying to repair damage like you would expect. Making your way to the bridge, you relax upon seeing a single handsome and well-dressed young man welding a bulkhead. His movements are dexterous and competent, but your practiced eye tells you that the bulkhead is damaged beyond repair, so his work is futile. He looks up and introduces himself as captain Tarquin, offering the princely sum of 350,000 credits for your expert help repairing his vessel.`
				goto "first decision"

			label "boarding with a big boarding party"
			`As your boarding party clambers aboard the <origin>, you realize you can't hear any sounds of frantic activity or see crew members scurrying around trying to repair damage like you would expect. Making your way to the bridge, you are greeted by a single handsome and well-dressed young man welding a bulkhead. His movements are dexterous and competent, but your practiced eye tells you that the bulkhead is damaged beyond repair, so his work is futile. He looks up and introduces himself as captain Tarquin, offering the princely sum of 350,000 credits for your expert help repairing his vessel.`

			label "first decision"
			choice
				`	(Accept this generous payment and help make repairs.)`
					accept
				`	"Not to look a gift horse in the mouth, but why are you offering so much money for my assistance?"`
					goto probe
				`	"Can we get some help from your crew?"`
					goto "crew missing"
				`	"Shouldn't a ship of this size have more crew?"`
					goto "crew missing"

			label probe
			`	Tarquin laughs self-consciously. "The truth is, I'm a bit desperate," he says. "My cargo hold is full of perishable goods that need to be delivered in three days to a very important client who will probably cut me off if I don't make the deadline. I thought I could save money by hiring inexperienced peasants to crew the ship, but as you can see, that hasn't worked out very well. They're cowering in their quarters even now. I'm offering you my profits from being a cheapskate. We'll call it paying for a lesson learned.`
				goto "get to work"

			label "crew missing"
			`	Tarquin laughs heartily. "That lot? They're a bunch of simple peasants I picked up on New India, off hiding in their quarters right now. The bumpkins are unaccustomed to this kind of danger, and don't have a lot of technical skills. My fault for being too cheap to hire good help, I suppose. I'm definitely going to pick up some more experienced and reliable crewmen after we get out of this mess."`

			label "get to work"
			`	"Can we get to work now?"`
			choice
				`	(Get to work repairing the ship.)`
					accept
				`	(Press the matter.)`
			`	Something about captain Tarquin's explanation doesn't sit right with you, so you keep asking questions to distract him while subtly walking towards the ship's crew section. As you get closer, you start to hear the faint sounds of people banging on walls and yelling for help. Tarquin's face displays an almost uncannily neutral expression, but his body is taut, as though every muscle has tensed up all at once.`
			choice
				`	"I think we took a wrong turn. Let's go repair your ship."`
					goto coward
				`	"Now I see what kind of ship you're running, but don't worry, you're among friends. No charge for those repairs."`
					goto "trickster or monster"
				`	"I'll help you, but the price just rose to a million credits, or I leave you here and tell the authorities that you're running a slave ship."`
					goto blackmailer
				`	"I demand that you release your slaves."`
					goto "the direct approach"
				`	(Attack him immediately.)`
					goto "attack but tarquin is prepared"

			label coward
			`	"Yes, let's do that," replies Tarquin. However, his friendly attitude is gone, and he remains as tense as a steel cable. You work in stony silence and awkwardly collect your payment once the <origin> is up and running again.`
			action
				set "tarquin hates you"
			`	You feel relieved that the whole situation is over once you're safely back on board your own ship.`
				accept

			label "trickster or monster"
			`	Tarquin relaxes. "It's so nice to encounter a like-minded captain in this unfriendly galaxy," he says. "I wouldn't dream of accepting repairs for free. Take the money anyway, I insist."`
			choice
				`	(Now go repair his ship.)`
					accept
				`	(Take advantage of the opening and attack him.)`
					goto "attack with the element of surprise"

			label "attack with the element of surprise"
			branch "attack alone with the element of surprise" "attack with a big boarding party"
				"flagship crew" < 3

			label "attack but tarquin is prepared"
			branch "attack alone but tarquin is prepared" "attack with a big boarding party"
				"flagship crew" < 3

			label "attack alone with the element of surprise"
			`	You draw your weapon as fast as you can.`
			branch "good luck" "bad luck"
				random < 80

			label "attack alone but tarquin is prepared"
			branch "good luck" "bad luck"
				random < 40

			label "attack with a big boarding party"
			`	Tarquin can't hope to stand alone against your entire boarding party and quickly surrenders. A look of cold fury glints in his eyes, even as the rest of his face remains calm.`
			choice
				`	(Execute him here and now.)`
					goto execution
				`	(Take him prisoner.)`
			branch "has brig"
				has "outfit (flagship installed): Brig"

			`	You instruct one of the members of your boarding party to tie him up and guard him. Tarquin curses you foully and bucks around as you search him, finding a concealed handgun and knife, and the credit chip he was going to pay you. You go to rescue the ship's crew.`
			`	The crew quarters have been fashioned into a brig with stout cell doors. There is no obvious way to open them, so you and your compatriots begin blasting them open.`
			`	Suddenly, a warning klaxon cuts through the noise with a harsh staccato. The ship's self-destruct sequence has been activated! You race to the room where Tarquin was being held, and find that he has somehow escaped. In his place is an unconscious member of your crew with a savage slash across his face, evidently inflicted by an additional concealed weapon you didn't manage to find. A nearby panel indicates that an escape pod has been jettisoned.`
			`	The ship will explode in less than 30 seconds. You realize bitterly that there is no chance you can release the prisoners in time, and trying anyway will just get everyone killed. You and your boarding party storm angrily back to your ship and release the docking clamps just in time for the <origin> to disintegrate into a cloud of space debris, cruelly ending the already unhappy lives of captain Tarquin's victims.`
			action
				set "tarquin hates you"
			`	You vow that it will be the last time you underestimate captain Tarquin, should your paths cross again.`
				launch

			label "has brig"
			`	You search Tarquin and find a concealed handgun and several knives, the credit chip he was going to pay you, and a tiny unlocking device. Then you instruct one of the members of your boarding party to lock him in your ship's brig. Tarquin curses you foully as he is marched to captivity at gunpoint. You resolve to figure out what to do with him later, and go to rescue the ship's crew.`
				goto "rescue the crew with tarquin captured"

			label execution
			`	You gun captain Tarquin down in cold blood, to the shock of at least one member of your boarding party. Good riddance to bad rubbish, you think, as you search the body of ex-captain Tarquin. You find a concealed handgun and several knives, the credit chip he was going to pay you, and a tiny unlocking device. You go to rescue his crew with it.`
				goto "rescue the crew"

			label blackmailer
			branch "blackmailing alone" "blackmailing with a big boarding party"
				"flagship crew" < 3

			label "blackmailing with a big boarding party"
			`	Tarquin eyes your boarding party and stares at you icily for at least five uncomfortable seconds before finally replying. "Fine," he said coldly, his eyes blazing with barely contained rage, even as the rest of his face remains calm. He remains as tense as a steel cable as you and your team repair the ship in stony silence, awkwardly collecting your payment once the <origin> is up and running again.`
			action
				set "tarquin hates you"
			`	You feel relieved that the whole situation is over once you're safely back on board your own ship.`
				decline

			label "blackmailing alone"
			`	"It'll be a cold day in hell before I get blackmailed by someone dumb enough to board a disabled ship all alone," sneers Tarquin.`
				goto "attack alone but tarquin is prepared"

			label "the direct approach"
			branch "acting stupid alone" "attack with a big boarding party"
				"flagship crew" < 3

			label "acting stupid alone"
			`	Captain Tarquin throws back his head and laughs at the exact moment that he draws a concealed pistol and shoots you with it five times - all in the blink of an eye. Your last thoughts concern the effectiveness of his distraction and the foolishness of your bravado.`
				die

			label "bad luck"
			`	Quick as a flash, he whips out a concealed pistol and drills a hole in your spine before you can react. The dangerous game you were playing ends abruptly.`
				die

			label "good luck"
			`	Quick as a flash, he whips out a concealed pistol, but you're faster. It's the last mistake he ever makes. You search the body of ex-captain Tarquin, finding several concealed knives in addition to his handgun, the credit chip he was going to pay you, and a tiny unlocking device. You go to rescue the crew with it.`
				goto "rescue the crew"

			label "rescue the crew"
			`	The ship's crew quarters have been fashioned into a brig with stout cell doors. Fortunately the unlocking device opens them all, and close to a dozen malnourished wretches stumble out, telling you the whole story: captain Tarquin has been keeping them as slaves for the past several months, locking them in their quarters when the ship makes berth, and with no food as a punishment when they complain. They are quite happy to see his lifeless body sprawled out on the deck plating.`
			`	You turn the <origin> over to them and return to your ship.`
				accept

			label "rescue the crew with tarquin captured"
			`	The ship's crew quarters have been fashioned into a brig with stout cell doors. Fortunately the unlocking device opens them all, and close to a dozen malnourished wretches stumble out, telling you the whole story: captain Tarquin has been keeping them as slaves for the past several months, locking them in their quarters when the ship makes berth, and with no food as a punishment when they complain. They are quite happy to hear that he has been taken into captivity.`
			action
				set "captured tarquin"
			`	You turn the <origin> over to them and return to your ship to figure out what to do with Tarquin.`
			`	A quick check of the public data in the galactic criminal justice database doesn't reveal that he's wanted for any crimes. You decide to turn him to law enforcement authorities on the nearest planet.`
				accept

	on decline
		payment 1000000
	on accept
		payment 350000

mission "Turn in Tarquin"
	description "Deliver captain Tarquin to law enforcement on the nearest planet."
	passengers 1
	landing
	to offer
		has "captured tarquin"
	destination "Earth"
	on offer
		set "turned in tarquin"
		conversation
			"You haul captain Tarquin out of your brig and bring him to the portside police station, presenting evidence from your suit cameras and notarized witness statements compiled from your crew members attesting to his crimes of being involved in slavery. The officer on duty thanks you for the service you've rendered, and takes Tarquin into custody. He shoots one final black look at you that sends a shiver up your spine."
				decline

mission "Boarding Derelict"
	boarding
	repeat
	invisible
	deadline 3
	to complete
		never
	source
		government "Derelict (Boardable)"
	destination "Earth"
	npc
		government "Pirate"
		personality entering nemesis vindictive staying
		fleet "pirate raid" 2
	on offer
		conversation
			`You board the <origin> and look around its derelict hull, which appears to be in fairly stable condition. You could risk repairing it for a greater profit, or you could salvage what you can from the ship and leave the rest.`
			choice
				`	(Salvage the ship.)`
					goto salvage
				`	(Attempt to repair the ship.)`
			`	Deciding to go for the bigger score you attempt to repair the ship.`
			choice
				`	(Repair the engines first.)`
					goto engines
				`	(Repair the hull first.)`
					goto hull
				`	(Repair the power first.)`
			branch powersurge
				random < 80
			`	With a few simple repairs you manage to get the ship's power systems operational and running smoothly.`
			choice
				`	(Repair the engines next.)`
					goto engines(p)
				`	(Repair the hull next.)`
					goto hull(p)
			label hull
			branch crumple
				random < 15
			`	It takes a while but you manage to stabilize the ship's hull. While doing so you managed to find and fix some broken wiring embedded in the hull, which could have caused a powersurge.`
			choice
				`	(Repair the engines next.)`
					goto engines(h)
				`	(Repair the power next.)`
					goto power(h)
			label hull(e)
			branch crumple
				random < 45
			`	It takes a while but you manage to stabilize the ship's hull. While doing so you managed to find and fix some broken wiring embedded in the hull, which could have caused a powersurge.`
			choice
				`	(Repair the power.)`
					goto power(eh)
				`	(Flee the ship for fear my repairs have made the ship more dangerous.)`
					goto flee
			label hull(p)
			branch crumple
				random < 25
			`	It takes a while but you manage to stabilize the ship's hull. While doing so you managed to find and fix some broken wiring embedded in the hull, which could have caused a powersurge.`
			choice
				`	(Repair the engines.)`
					goto engines(hp)
				`	(Flee the ship for fear my repairs have made the ship more dangerous.)`
					goto flee
			label hull(ep)
			branch crumple
				random < 75
			`	It takes a while but you manage to stabilize the ship's hull. While doing so you managed to find and fix some broken wiring embedded in the hull, which could have caused a powersurge.`
			`	With the repairs finished you head to the cockpit to see if the <origin> starts without exploding. Prepared to bolt for the airlock should things go wrong, you start the ship.`
			branch fail
				random < 40
			`	The ship thrums to life. With bated breath you wait for the sound of some system exploding, but nothing happens. Success! The ship is yours.`
				goto success
			label engines
			branch misfire
				random < 60
			`	As you are fixing the engine systems a valve bursts open. Luckily the secondary valve is mechanical and doesn't need power, allowing it to close itself automatically and prevent the coolant from forcefully spraying out. With more caution, you finish up your repairs of the engines.`
			choice
				`	(Repair the hull next.)`
					goto hull(e)
				`	(Repair the power next.)`
					goto power(e)
			label engines(h)
			branch misfire
				random < 60
			`	As you are fixing the engine systems a valve bursts open. Luckily the secondary valve is mechanical and doesn't need power, allowing it to close itself automatically and prevent the coolant from forcefully spraying out. With more caution, you finish up your repairs of the engines.`
			choice
				`	(Repair the power.)`
					goto power(eh)
				`	(Flee the ship for fear my repairs have made the ship more dangerous.)`
					goto flee
			label engines(p)
			`	As you are fixing the engine systems a valve bursts open. Luckily you restored power, allowing the secondary valve to close itself automatically and prevent the coolant from forcefully spraying out. With more caution, you finish up your repairs of the engines.`
			choice
				`	(Repair the hull.)`
					goto hull(ep)
				`	(Flee the ship for fear my repairs have made the ship more dangerous.)`
					goto flee
			label engines(hp)
			`	As you are fixing the engine systems a valve bursts open. Luckily you restored power, allowing the secondary valve to close itself automatically and prevent the coolant from forcefully spraying out. With more caution, you finish up your repairs of the engines.`
			`	With the repairs finished you head to the cockpit to see if the <origin> starts without exploding. Prepared to bolt for the airlock should things go wrong, you start the ship.`
			branch fail
				random < 5
			`	The ship thrums to life. With bated breath you wait for the sound of some system exploding, but nothing happens. Success! The ship is yours.`
				goto success
			label power(h)
			branch powersurge
				random < 5
			`	With a few simple repairs you manage to get the ship's power systems operational and running smoothly.`
			choice
				`	(Repair the engines.)`
					goto engines(hp)
				`	(Flee the ship for fear my repairs have made the ship more dangerous.)`
					goto flee
			label power(e)
			branch powersurge
				random < 55
			`	With a few simple repairs you manage to get the ship's power systems operational and running smoothly.`
			choice
				`	(Repair the hull.)`
					goto hull(ep)
				`	(Flee the ship for fear my repairs have made the ship more dangerous.)`
					goto flee
			label power(eh)
			branch powersurge
				random < 15
			`	With a few simple repairs you manage to get the ship's power systems operational and running smoothly.`
			`	With the repairs finished you head to the cockpit to see if the <origin> starts without exploding. Prepared to bolt for the airlock should things go wrong, you start the ship.`
			branch fail
				random < 25
			`	The ship thrums to life. With bated breath you wait for the sound of some system exploding, but nothing happens. Success! The ship is yours.`
				goto success
			label powersurge
			`	With a few simple repairs you manage to get the ship's power systems operational. Briefly. The power shuts down again with a violent vibration shuddering through the ship. You quickly run back to your ship before the <origin> breaks apart.`
				depart
			label crumple
			`	As you are patching up a segment of hull you notice that a deformation in it is slowly expanding. To make matters worse, this is a structurally essential part of the hull. You quickly run back to your ship before the <origin> breaks apart.`
				depart
			label misfire
			`	As you are fixing the engine systems a valve bursts open. With no power the secondary valve cannot close itself off, letting coolant uncontrollably fly into the hull. The force of the liquid sends a violent vibration shuddering through the ship. You quickly run back to your ship before the <origin> breaks apart.`
				depart
			label flee
			action
				payment 7500
			`	Wary of your own foolish repairs you decide to leave the ship alone. However, you did manage to hang onto a little bit of scrap worth <payment> you found during your repairs.`
			`	Your fears seem to be warranted as the <origin> begins to falls apart the moment you detach.`
				depart
			label fail
			`	As it begins to thrum to life, a loud explosion rocks the ship!`
			choice
				`	(Run.)`
			`	You start running through the tight corridors of the ship. Objects are tumbling everywhere, and more explosions threaten to sweep you off your feet.`
			choice
				`	(Run into the airlock.)`
					goto run
				`	(Dive for the airlock.)`
					goto dive
				`	(Slide into the airlock.)`
			`	As you slide across the floor, explosions erupt on both sides of you, and you're sure that you look like an action hero as you careen through the airlock to safety. Having narrowly escaped death and not wishing to chance it, you quickly depart.`
				depart
			label run
			`	As you run towards the airlock, explosions erupt on both sides of you, and you're sure that you look like an action hero as you barge through the airlock to safety. Having narrowly escaped death and not wishing to chance it, you quickly depart.`
				depart
			label dive
			`	As you dive towards the airlock, explosions erupt on both sides of you, and you're sure that you look like an action hero as you tuck and roll through the airlock to safety. Having narrowly escaped death and not wishing to chance it, you quickly depart.`
				depart
			label success
			branch beacon
				random < 15
			branch virus
				random < 5
				"credits" > 1000000
			action
				payment 65000
			`	Despite your best efforts to make the ship actually fly, it just won't. On the upside, now you have time to loot and pilfer some outfits from the ship as you please. Before leaving the cockpit you find a credit chip sitting on the controls worth <payment>.`
				decline
			label beacon
			`	However, you notice a blinking light on the controls of the ship. You wonder what it could signal as you approach it, and once you get close enough you realize that it warns of the arrival of "hostile spacecraft" entering the system. The derelict must have been a pirate trap, and to make matters worse, the ship appears to be rigged to blow! You now have a pretty good guess at what you're dealing with as you race back to your ship.`
				launch
			label virus
			action
				payment -200000
			`	However, moments later a screen lights up in the cockpit displaying something strange. Upon closer inspection you realize it's some form of malicious software, and it's attempting to hack into your ship!`
			`	You race back to your ship, quickly launching and destroying the <origin>, but by the time you manage to destroy the virus it has already hacked into your bank account; your account reports a change in balance of <payment>.`
				depart
			label salvage
			`	Deciding not to risk it you quickly scour the ship for valuable scrap and outfits.`
			branch valuable
				random < 40
			action
				payment 10000
			`	Upon a brief inspection of the ship you find few valuables, only managing to salvage a meager <payment> from the <origin>.`
				goto detonate
			label valuable
			branch rare
				or
					and
						random < 25
						or
							not "derelict treasure map: ion cannons"
							not "derelict family investment"
					random < 5
			action
				payment 63000
			`	Searching through the ship you find that it is quite valuable; you manage to salvage a substantial amount from the <origin>, worth <payment>.`
				goto detonate
			label rare
			branch quest
				or
					not "derelict treasure map: ion cannons"
					not "derelict family investment"
			action
				payment 475000
			`	Hidden away under a panel you find a small box. Opening it reveals it is filled with <payment>.`
				goto detonate
			label quest
			branch treasure
				not "derelict treasure map: ion cannons"
				or
					random < 50
					has "derelict family investment"
			action
				set "derelict family investment"
			`	As you search the ship for anything valuable you find a large black case filled with 325,000 credits. Investigating further you find a text log next to the case, and you decide to take both of them with you.`
				goto detonate
			label treasure
			action
				set "derelict treasure map: ion cannons"
				payment 26500
			`	As you search the ship for anything valuable you find some kind of map tucked into a panel. It's easy to carry, allowing you time to further salvage a meager <payment> from the <origin>.`
				goto detonate
			label detonate
			choice
				`	(Detonate the ship and leave so that others can't loot it.)`
				`	(Try and find a bit more salvage.)`
					goto continued
			`	Before you depart you detonate the ship to prevent any other derelict hunters from scouring the now empty ship.`
				depart
			label continued
			branch unlucky
				random < 75
			action
				payment 35000
			`	You attempt to search the ship for more valuables and luckily find some extra salvage worth <payment>. However, the hull begins to creak and groan, prompting a hasty return to your ship.`
			`	Not a moment too soon, as the <origin> begins to violently fall apart the moment your ship detaches.`
				depart
			label unlucky
			branch pirate
				random < 20
			`	You attempt to search the ship for more valuables but to no avail. However, the hull begins to creak and groan, prompting a hasty return to your ship.`
			`	Not a moment too soon, as the <origin> begins to violently fall apart the moment your ship detaches.`
				depart
			label pirate
			`	You make your way to the cockpit in the hopes of finding any valuables. Initially finding nothing, you turn to leave and search more of the ship.`
				goto beacon
