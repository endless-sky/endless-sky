# Copyright 2020 by Peter van der Meer
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.

test "Test-Framework - Empty Testcase"
	status "active"
	description "Test with no test sequence. Only starts and exits the game"



test "Test-Framework - Empty Test Sequence"
	status "active"
	description "Test with an empty sequence. Only starts and exits the game"
	sequence



test "Test-Framework - Conditions Arithmetic and Loops"
	status "active"
	description "Test condition-setting, condition-checking, additions, labels and branching."
	sequence
		watchdog 100
		apply
			"test: myFirstTestVariable" = 100
			"test: mySecondTestVariable" = 200
		assert
			"test: myFirstTestVariable" == 100
			"test: mySecondTestVariable" == 200
		apply
			"test: myFirstTestVariable" += 100
			"test: mySecondTestVariable" += 200
		assert
			200 == "test: myFirstTestVariable"
		assert
			400 == "test: mySecondTestVariable"
		label looping
		apply
			"test: loopControl" += 1
			"test: myFirstTestVariable" -= 5
			"test: mySecondTestVariable" *= 2
		branch looping
			"test: loopControl" < 10
		assert
			10 == "test: loopControl"
			"test: myFirstTestVariable" == 200 - 50
			400 * 1024 == "test: mySecondTestVariable"


test "Test-Framework - UI Keyboard controls"
	status active
	description "Tests if the in-game panels can be controlled by keypresses"
	sequence
		# Create/inject the savegame, go to the load screen and load the first (and only) savegame.
		inject "Three Earthly Barges"
		input
			key l
		input
			key l
		# Enter and leave jobs
		input
			key j
		input
			key d
		# Enter trading
		input
			key t
		# Enter bank
		input
			key b
		# Enter spaceport
		input
			key p
		# Enter and leave shipyard
		# Skipped, since Earth (the starting planet) doesn't have a shipyard.
		#input
		#	key s
		#input
		#	key l
		# Enter and leave outfitter
		input
			key o
		input
			key l
		# Enter hire-crew section
		input
			key h
		# Depart
		input
			key d


test "Test-Framework - UI Pointer controls"
	status active
	description "Tests if the in-game panels can be controlled by pointer controls"
	sequence
		# Create/inject the savegame, go to the load screen and load the first (and only) savegame.
		inject "Three Earthly Barges"
		input
			key l
		input
			key l
		# Enter and leave jobs
		input
			key j
		input
			key d
		# Enter trading
		input
			pointer
				# Go from middle of the screen (to allow many resolutions)
				X 0.5 relative
				Y 0.5 relative
				# Go for the center of the trading button
				X -411
				Y 92
				click left
		# Enter bank
		input
			pointer
				# Go from middle of the screen (to allow many resolutions)
				X 0.5 relative
				Y 0.5 relative
				# Go for the center of bank button
				X -409
				Y 211
				click left
		# Enter spaceport
		input
			pointer
				# Go from middle of the screen (to allow many resolutions)
				X 0.5 relative
				Y 0.5 relative
				# Go for the center of the spaceport button
				X -410
				Y 270
				click left
		# Enter and leave shipyard
		#   Skipped, since Earth (the starting planet) doesn't have a shipyard.
		# Enter and leave outfitter
		input
			pointer
				# Go from middle of the screen (to allow many resolutions)
				X 0.5 relative
				Y 0.5 relative
				# Go for the center of the outfitter button
				X 284
				Y 148
				click left
		input
			pointer
				# Leave outfitter, button is relative to lower right corner.
				X -47
				Y -27
				click left
		# Enter hire-crew section
		input
			pointer
				X 291
				Y 209
				click left
		# Depart
		input
			pointer
				X 291
				Y 269
				click left


test "Test-Framework - Load and depart"
	status active
	description "Test with only a departure. Mostly tests the testframework itself."
	sequence
		# Create/inject the savegame, go to the load screen and load the first (and only) savegame.
		inject "Three Earthly Barges"
		input
			key l
		input
			key l
		# Check startup conditions.
		assert
			"ships: Light Freighter" = 3
		# Launch.
		input
			key d
		# Re-check startup conditions.
		assert
			"ships: Light Freighter" = 3


test "Test-Framework - Navigate"
	status active
	description "Test-Framework - Navigation to other star system"
	sequence
		# Create/inject the savegame, go to the load screen and load the first (and only) savegame.
		inject "Three Earthly Barges"
		input
			key l
		input
			key l
		# Set desired travel plan.
		navigate
			travel "Alpha Centauri"
			travel "Sol"
			travel "Alpha Centauri"
		# Launch.
		input
			key d
		input
		input
		# Give jump command.
		input
			command	jump
		watchdog 12000
		label notAlpha1
		branch notAlpha1
			not "flagship system: Alpha Centauri"
		watchdog 12000
		label notSol
		branch notSol
			not "flagship system: Sol"
		watchdog 12000
		label notAlpha2
		branch notAlpha2
			not "flagship system: Alpha Centauri"
