# Copyright (c) 2019 by Tommaso Becca
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.

mission "Graveyard Label"
	landing
	invisible
	source
		attributes ka'het
	on offer
		event "graveyard label"
		fail

event "graveyard label"
	galaxy "label graveyard"
		sprite label/graveyard

mission "Disabled Ka'het"
	boarding
	invisible
	source
		government "Ka'het" " Ka'het "
	destination "Earth"
	on offer
		log "Successfully boarded a Ka'het. It appears to be a single, ship-sized organism that can travel in space using a special exoskeleton."
		conversation
			`Your ship slowly approaches the <origin>, now floating lifeless near you. As you move closer, you spot a massive hole in the hull of the ship, revealing what appears to be a large, slug-like being. While most of the ship's machinery doesn't seem to have received heavy damage, weapons fire must have hit the slug's vital organs, killing it, after which point the ship seems to have stopped working.`
			`	You have no troubles docking with what seems to be its "exoskeleton", trying to decide what to do next: while the Ka'het is too different from a ship for you to command it, it's safe to say that you can now loot its outfits.`
				decline

mission "First Contact: Ka'het: Remnant 1A"
	landing
	invisible
	source
		government "Remnant"
	to offer
		has "Graveyard Label: offered"
		not "remnant met taely"
	on offer
		conversation
			`Do you want to ask the Remnant about the section of space south of the Ember Wastes, the Graveyard, and its inhabitants?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	You ask around more than a dozen people, but none of them seems to be aware of what you're talking about. Either the information is too confidential to be given to a stranger like you, or you didn't ask the right people.`
				decline

mission "First Contact: Ka'het: Remnant 1B"
	landing
	invisible
	source "Viminal"
	to offer
		has "Graveyard Label: offered"
		has "remnant met taely"
	on offer
		conversation
			`Do you want to ask Taely about the section of space south of the Ember Wastes, the Graveyard, and its inhabitants?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	You find Taely inside one of the outer hangars of the shipyard, apparently teaching a small group of people how to make basic repairs on an Albatross. You sit on a bench waiting for her to finish her lesson, after which she walks over to you. "Hello, <first>!" she says. "Is there something I can help you with?" `
			`	"I'm here because I need to ask you a few questions," you reply.`
			`	As she sits near you, you start explaining to her the area you reached, including the weird alien ships that attacked you with weapons similar to the ones the Remnant possess. It doesn't seem to be news for her. "We know of the existence of these Ka'het, the aliens you encountered, since we first reached the Ember Wastes. We found many of their 'shells' in our planets, crashed there thousands or even tens of thousands of years before our arrival, but with some tech so advanced to still be conserved enough to be reverse engineered.`
			`	"Then," she continues, "a few hundred years ago, a scout fleet arrived in a system where some Ka'het were still alive, which attacked the Remnant almost instantly and before they could activate the cloak some EMPs had already disabled two Starlings. They couldn't recover soon enough to survive, and the only remaining ship could do nothing but flee here as soon as possible."`
			choice
				`	"Which technology did you recover from the crashed Ka'het?"`
					goto tech
				`	"Wait, why did you call them 'shells' and not ships?"`
					goto shells
				`	"Have the Ka'het ever attacked the Remnant planets?"`
			`	"Actually, we never met any Ka'het in the Ember Waste at all. The 'shells' we found had similar capabilities to the quantum keystone, meaning they could pass through the wormholes, so we don't know for sure why they remain there. Perhaps they aren't aware of their skills, or maybe they lost them over time."`
			choice
				`	"Wait, why did you call them 'shells' and not ships?"`
					goto shells
			label tech
			`	"Back then we found large numbers of their EMP torpedoes, most of which in almost pristine conditions; their internal mechanisms were also simple enough we were able to reproduce them perfectly. We didn't find enough of the other systems in the 'shells' to do the same, but their tech still have been our main inspiration point for centuries."`
			choice
				`	"Wait, why did you call them 'shells' and not ships?"`
			label shells
			`	"You see, <first>," she says, "the Ka'het aren't normal spaceships. The debris we found were artificial exoskeletons, built around huge living beings; it's unlikely a species that big could have developed that sort of technology, so we presume someone must have created it for them. This could have happened in the Graveyard, since it's the only place where we know them to still live in, but we have such a limited data about that section of space that we can't say for sure." As she finishes talking, one of the people Taely's was talking with earlier comes closer and shows her something on a touchpad. "I have to go now, Captain," she tells you. "Good luck."`
				decline
	on decline
		log "Asked Taely about the Graveyard and the Ka'het. She spoke of the previous contacts between them and the Remnant."
		log "Factions" "Ka'het" `The Ka'het are aliens which live in an area south of the Ember Waste, called the Graveyard. They are large lifeforms which can travel in space using artificial exoskeletons and will attack anyone on sight, even sometimes other Ka'het.`

mission "Ringworld Debris"
	invisible
	landing
	on enter Queri
		conversation
			`When you enter this suspiciously empty system, your attention is drawn to your ships' scanners, which picked up some odd thermal waves close to your ship.`
			`	You're then notified that whatever the signal is, it is rotating extremely slowly in place, though you can't quite see it yet, no matter how much you tinker with the scanning systems.`
			`	You slightly move your ship, and catch the object, seizing it into your cargo hold. When you go there to inspect it, you see a small, dark piece of debris, about the size of a bag, but it doesn't resemble any alloy you've see on a spaceship or station, bearing semblance to both a crystal and a metallic structure.`
			`	In one particular corner you see that there is a small tube of sorts, and after tinkering a bit you manage to connect it to your ship's secondary power systems. It doesn't draw too much energy, but you can feel the air around it starting to get slightly colder.`
			`	You unplug it and store the debris in a separate part of your ship. Maybe some alien species could tell you about it, if you were to bring it to them.`

mission "Ringworld Debris: Remnant"
	invisible
	landing
	source
		government "Remnant"
	to offer
		has "Ringworld Debris: active"
		has "Graveyard Label: offered"
		has "remnant blood test pure"
	on offer
		conversation
			`Do you want to show the Remnant the piece of debris you found in the Graveyard, and ask them what they know about it?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	The Remnant are quick to have a tech group come to your ship when you mention you've found an odd piece of technology, but they seem disappointed when they see the dark object, and their interest fully vanishes when you explain the system you found it and how it reacted to being fed some energy.`
			`	"We've found many pieces like that drifting in that system over the years. It could be maybe used to improve our cooling systems, but we could never begin to comprehend how it works," one of them says.`
			`	However unexpected a response like this from the Remnant is, they simply leave your ship shortly after, claiming that it is useless to gather debris like that.`
				decline

mission "Ringworld Debris: Hai"
	invisible
	landing
	source
		government "Hai"
	to offer
		has "Ringworld Debris: active"
		has "Graveyard Label: offered"
		has "First Contact: Hai: offered"
	on offer
		conversation
			`Do you want to show the Hai the piece of debris you found in the Graveyard, and ask them what they know about it?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	You ask around for a bit, and eventually are lead to a building where some Hai engineers and shipwrights are gathered, a workshop of some kind.`
			`	"Greetings, human friend! How may we help you?"`
			`	You show them the piece of debris, and they observe it for a bit, plugging it like you did on your own ship, and seeing how it behaves. They look puzzled along the entire process, and eventually conclude they don't have the necessary equipment to fully analyze it.`
			`	"Sorry, whatever it is that you've found, it is too advanced a technology for our systems," they say. You thank them for their time, and head back to your ship.`
				decline

mission "Ringworld Debris: Coalition"
	invisible
	landing
	source
		government "Coalition" "Heliarch"
	to offer
		has "Ringworld Debris: active"
		has "Graveyard Label: offered"
		has "Coalition: First Contact: done"
	on offer
		conversation
			`Do you want to show the members of the Coalition the piece of debris you found in the Graveyard, and ask them what they know about it?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	After asking around, you're directed to a Heliarch building, an outpost. "Of assistance, how may we be, kind visitor?" An agent asks.`
			`	You show them the dark debris piece, and explain where you've found it. They are clearly surprised by it, but don't hold you up for long, and don't attempt to perform any tests on it.`
			`	"A piece of Quarg technology, this !" They say, asking again for you to explain where exactly you found it, as they make sure to write it all down this time.`
			`	They then say that they have experienced with technology they managed to steal from the Quarg during their war, and that the debris is probably a somewhat common component in Quarg equipment.`
			`	You wonder for a bit if they will ask to buy the piece, judging by how excited they seem, but they finish saying that they have enough technology to study as is, and also that the piece you found has deteriorated much compared to what they have acquired for themselves.`
			`	You thank them for their time and the explanation, and head back to your ship.`
				decline

mission "Ringworld Debris: Quarg"
	invisible
	landing
	deadline 1
	source
		government "Quarg"
	to offer
		has "Ringworld Debris: active"
		has "Graveyard Label: offered"
		has "First Contact: Quarg: offered"
	on offer
		fail "Ringworld Debris"
		conversation
			`Do you want to show the Quarg the piece of debris you found in the Graveyard, and ask them what they know about it?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	Walking down the principal, alien-looking hall, you decide to stop one of the few Quarg you see there. "Hello, human. How may I be of service?" the Quarg says. You reply by showing him the piece of debris, asking him about it.`
			`	He is momentarily stunned when you show the dark piece of technology, calmly taking it into their own hands after recovering.`
			`	"A fragment of our ships, is what it is. A remnant of part of our equipment, thank you for returning it to us."`
			`	You continue by telling him about your travels in the Graveyard, and asking what they know of the place and the hostiles that inhabit it.`
			`	"Ah, you encountered the remains of the Builders. Millennia ago, they were a flourishing and thoughtful empire, but hostile contacts forced them to grow fearful and hawkish. Although they never did attack us, they always refrained from accepting our aid, and attempted to relocate a greater distance from us and our ringworld there, in worlds easier to maintain than ones they were closer to."`
			choice
				`	"Who were these hostile contacts?"`
				`	"What happened to the Builders?"`
					goto ka'het
			`	"Long ago, few ships coming from a foreign species had reached that region of space, using some of the wormholes leading there. They belonged to a young race who foolishly decided to attack the Builders instead of learning from them. Their ships were stronger than any vessel the Builders possessed at the time, but were also few enough in number to be destroyed by the Builders."`
			choice
				`	"What happened after that?"`
			label ka'het
			`	The Quarg stops for a few seconds before continuing, as if he was reflecting on something. "For many millennia they grew, developing brilliant pieces of technology. Then, compelled by their past experiences, they began creating weapons not only to defend themselves, but also to retaliate; these 'Ka'het', as they named them, turned on their creators shortly after they were complete.`
			`	"For a few more centuries the Builders lasted, before falling under their very own hubris. Their space is still populated by the Ka'het they gave birth to through the immense facilities they assembled, a being that does not yet possess a vast intelligence." The Quarg bows, still holding on to the piece of debris, and seems to be preparing to walk away.`
			branch pug
				has "main plot completed"
			choice
				`	"What happened to your ringworld in the Graveyard? Was it in the system I found that thing?"`
				`	(Let the Quarg walk away.)`
					decline
			`	For the briefest moment, you see patches of skin all over the Quarg's body radically shift from the usual grey to red and blue, some spots mixing into purple, and you could have sworn you saw some part of the iris on his eyes "open" very slightly.`
			`	After coming back to normal, he ponders for a second, then says, "It was in that system, and it was lost in a war, millennia after the Builders had perished."`
			`	He doesn't seem too inclined on answering any more questions, and swiftly walks away.`
				decline
			label pug
			choice
				`	"What happened to your ringworld in the Graveyard? Was it in the system I found that thing?"`
				`	(Let the Quarg walk away.)`
					decline
			`	For the briefest moment, you see patches of skin all over the Quarg's body radically shift from the usual grey to red and blue, some spots mixing into purple, and you could have sworn you saw some part of the iris on his eyes "open" very slightly.`
			`	After coming back to normal, he ponders for a second, then says, "It was in that system, and it was lost in our war with the despicable Pug. When we tried to resist them. By then, the Builders had been gone for millennia."`
			`	He doesn't seem too inclined on answering any more questions, and swiftly walks away.`
				accept
	on decline
		log "Asked the Quarg about the history of the Graveyard, and have learned about the previous inhabitants of the region, the Builders."
		log "Factions" "Builders" `The Builders inhabited the Graveyard millennia ago, but have since become extinct. They developed some sort of weapon, called the "Ka'het," which stopped obeying their orders and rebelled against them.`
		log "Factions" "Ka'het" `According to the Quarg, the Ka'het were initially a weapon created by the Builders, which then rebelled and led them to extinction. Even in the millennia that passed, they are still being produced in the Graveyard.`
	on accept
		log "Asked the Quarg about the history of the Graveyard. Was told that the ringworld the Quarg was lost in their war with the Pug, and have learned about the previous inhabitants of the region, the Builders."
		log "Factions" "Builders" `The Builders inhabited the Graveyard millennia ago, but have since become extinct. They developed some sort of weapon, called the "Ka'het," which stopped obeying their orders and rebelled against them.`
		log "Factions" "Ka'het" `According to the Quarg, the Ka'het were initially a weapon created by the Builders, which then rebelled and led them to extinction. Even in the millennia that passed, they are still being produced in the Graveyard.`
