# Copyright (c) 2019 by Tommaso Becca
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.

mission "Graveyard Label"
	landing
	invisible
	source
		attributes ka'het
	on offer
		event "graveyard label"
		fail

event "graveyard label"
	galaxy "label graveyard"
		sprite label/graveyard

mission "Disabled Ka'het"
	boarding
	invisible
	source
		government "Ka'het" " Ka'het "
	destination "Earth"
	on offer
		log "Successfully boarded a Ka'het. It appears to be a single, ship-sized organism that can travel in space using a special exoskeleton."
		conversation
			`Your ship slowly approaches the <origin>, now floating lifeless near you. As you move closer, you spot a massive hole in the hull of the ship, revealing what appears to be a large, slug-like being. While most of the ship's machinery doesn't seem to have received heavy damage, weapons fire must have hit the slug's vital organs, killing it, after which point the ship seems to have stopped working.`
			`	You have no troubles docking with what seems to be its "exoskeleton", trying to decide what to do next. While the Ka'het is too different from a normal ship for you to command it, it's safe to say that you can now loot its outfits.`
				decline

mission "First Contact: Ka'het: Remnant 1A"
	landing
	invisible
	source
		government "Remnant"
		not planet "Viminal"
	to offer
		or
			has "Graveyard Label: offered"
			has "Ringworld Debris: offered"
		has "remnant blood test pure"
		not "remnant met taely"
	on offer
		conversation
			`Do you want to ask the Remnant about the section of space south of the Ember Wastes, the Graveyard, and its inhabitants?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			branch Taely
				has "remnant met taely"
			`	You ask around more than a dozen people, but none of them seems to be aware of what you're talking about. Either the information is too confidential to be given to a stranger like you, or you didn't ask the right people.`
				decline
			label Taely
			`	You ask around more than a dozen people, but none of them seems to be aware of what you're talking about. Perhaps you might have more luck asking Taely on Viminal.`
				decline

mission "First Contact: Ka'het: Remnant 1B"
	landing
	invisible
	source "Viminal"
	to offer
		or
			has "Graveyard Label: offered"
			has "Ringworld Debris: offered"
		has "remnant met taely"
	on offer
		conversation
			`Do you want to ask Taely about the section of space south of the Ember Wastes, the Graveyard, and its inhabitants?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	You find Taely inside one of the outer hangars of the shipyard, apparently teaching a small group of people how to make basic repairs on an Albatross. You sit on a bench waiting for her to finish her lesson, after which she walks over to you. "Hello, <first>!" she says. "Is there something I can help you with?" `
			`	"I'm here because I need to ask you a few questions," you reply.`
			`	As she sits near you, you start explaining to her the area you reached, including the weird alien ships that attacked you with weapons similar to the ones the Remnant possess, although this doesn't seem to be news for her. "We know of the existence of the Ka'het, the aliens you encountered, since we first reached the Ember Wastes. We found many of their shells within our planets, crashed there thousands, perhaps even tens of thousands of years before our arrival, but some of their outfits survived long enough for us to reverse engineer these advanced technologies."`
			`	"Then," she continues, "a few hundred years ago, a scout fleet arrived in a system where some Ka'het were still alive. They attacked our fleet instantly with EMP Torpedoes that quickly disabled two Starlings. The Starlings couldn't recover quickly enough to survive, and the only remaining ship could do nothing but flee as soon as possible."`
			choice
				`	"Which technology did you recover from the crashed Ka'het?"`
					goto tech
				`	"Wait, why did you call them 'shells' and not ships?"`
					goto shells
				`	"Have the Ka'het ever attacked the Remnant planets?"`
			`	"Actually, we never met any living Ka'het in the Ember Waste at all. The shells we found had similar capabilities to the quantum keystone, meaning they could pass through the wormholes, so we don't know for sure why they remained in the Graveyard. Perhaps they aren't aware of their skills, or maybe they lost them over time."`
			choice
				`	"Wait, why did you call them 'shells' and not ships?"`
					goto shells
			label tech
			`	"Back then we found large numbers of their EMP torpedoes, most of which were in nearly pristine condition; their internal mechanisms were also simple enough that we were able to reproduce them perfectly. We couldn't do the same with the other surviving systems in the shells, but their tech has been a source of inspiration for centuries."`
			choice
				`	"Wait, why did you call them 'shells' and not ships?"`
			label shells
			`	"You see, <first>," she says, "the Ka'het aren't normal spaceships. The debris we found were artificial exoskeletons, built around huge living beings; it's unlikely a species that big could have developed that sort of technology, so we presume someone must have created it for them. We call them the Builders. After we lost the first scout ships in the Graveyard, the prefects at the time decided that we should not stop our attempts to scout the region, but instead ensure to never have to decloak before getting back to safe space. Thanks to those protocols, some of which are still applied today, we were able to extensively explore most of the Graveyard and decipher a good amount of the written language we found. A large number of missions down there were limited to recovering some debrises from a designated site and taking them here before running out of fuel though, so there is still a lot we have yet to discover." You keep talking about the Graveyard with Taely for a while longer, until one of the people she was talking to earlier comes closer and shows her something on a touchpad. "I have to go now, Captain," she tells you. "Good luck."`
				decline
	on decline
		event "Graveyard insights"
		log `Asked Taely about the Graveyard and the Ka'het and learned of the Remnant's previous contacts between them.`
		log "Factions" "Ka'het" `The Ka'het are a species which live in the Graveyard, an area south of the Ember Waste. They are large lifeforms which can travel in space using artificial exoskeletons and will attack anyone on sight, even other Ka'het.`

event "Graveyard insights"
	planet Alix
		spaceport `Long ago, the Builders were stripping this moon to build the nearby Parii'het space station, as well as to produce the Ka'het hulls. The Ka'het attacks limited to the inhabited settlements on Alix; had they also destroyed the mining bases and the unmanned drones, the station would have run out of supplies thousands of years ago.`
		spaceport `	This could mean the Ka'het developed some sort of basic intelligence, or more simply that their scanners did not detect them as threats.`
	planet Celeatis
		spaceport `This planet appears to have been home to one of the largest Builder research centers, focused on studying the anomaly in the system. Had they found out how to stabilize it and use it as a wormhole, perhaps their species would have survived, spreading in the rest of the Ember Waste.`
		spaceport `	Due to the impossibility of using the local terrain to grow crops, the inhabitants of Celeatis had to rely on the food produced abroad. When the Ka'het came, the supplies abruptly stopped arriving, and in less than a year the planetary food reserves were depleted. The planet's population who had survived the invasion didn't last much longer.`
	planet Ceilia'sei
		spaceport `Celia'sei was constructed to act as some sort of anti-missile platform. When the Ka'het invasion broke out for the second time, it must have been able to shoot down the EMPs fired nearby without any trouble; but it had no way to defend itself against the deadly Ravager Beams. The crew quarters were soon blown up by the incoming fleets, losing control of the station's defense systems forever.`
		spaceport `	Given its location, it's likely that Ceilia'sei was originally built to stop something coming out of the wormhole rather than the Ka'het themselves.`
	planet Eavine
		spaceport `Eavine played a crucial role in the demise of the Builders: here, a second wave of Ka'het was built, made with the objective of pushing the first one back. They soon found out that what was supposed to change the result of the invasion only accelerated it, refusing to obey the Builders once again and allowing the Ka'het to reach their northern systems.`
		spaceport `	The moon had been terraformed to make it a more appealing place to live, but after their civilization collapsed the moon began to return to its natural state. A few thousand years ago, Eavine turned back being so cold that the facilities stopped working and the Ka'het production in this site came to an end.`
	planet "Letis'sei"
		spaceport `Letis'sei was a so called "weapon-station" designed to be commanded by the smallest amount of crew possible, with only a tiny fraction of the station designed to be inhabited. The rest of the station, instead, was dedicated to advanced computing and targetting systems.`
		spaceport `	Given the short time it must have taken the Ka'het to blow the crew quarters up, the rest of the station was left almost untouched.`
	planet Osaeli
		spaceport `For most of the thousands of years that passed between the time their discovery of spaceflight and their extinction, Osaeli this was the de facto capital of the Builders, a key part of their economy and society. The first Het station, with the purpose of protecting them from any external threat, was constructed orbiting this planet's same star because of this.`
		spaceport `	Incidentally, when the invasion broke out, Osaeli was also the world closest to the Ka'het fleets: it kept being devastated for years, until every Builder on the planet was killed.`
	planet Palarei
		spaceport `Thanks to their earlier exploration vessels, here the Builders encountered the first lifeforms that evolved outside of their home planet. While the climate here was very different from what they were used to, the fruits the local flora produced were popular enough that Palarei became a major farming spot for a long time.`
		spaceport `	The farms on Palarei were one of the few successful attempts at creating fully automatic facilities for the Builders. A few dozen of them, partly thanks to the rudimental repair systems they tried to develop, is still working even today.`
	planet Parii'het
		spaceport `Parii'het was almost finished when the invasion broke out, and already capable of (slowly) creating Ka'het. Thanks to the mining operations on Alix and the occasional asteroid mining operated by the Mar drones, most of the facilities are still fully operational to this day.`
		spaceport `	Differently from most of the Graveyard, the station doesn't seem to have ever suffered any damage from the Ka'het, nor from the Builders trying to regain control over it.`
	planet Retilie
		spaceport `Retilie was used by the builders mainly for fishing, leading to a lack of infrastructural development. The few settlements on the planet were never as advanced as the ones on the nearby worlds, and when the Ka'het arrived there was basically nothing to stop them: after a few attacks, the planet was uninhabited again.`
		spaceport `	In the oceans, the many species of fish continue to prosper, unaware of the destruction the planet has undergone.`
	planet Seli'het
		spaceport `Seli'het was the only Het station the Builders ever completed, orbiting Giribea. The young Ka'heta are brought here once they reach the "Age of Assembly;" strange, lanky machines start molding an exoskeleton onto their bodies right away. As the Ka'het grow, their exoskeleton is expanded and various outfits are added, transforming them into living weapons.`
		spaceport `	In this system the Ka'het behave differently than basically anywhere else as they don't seem to ever attack each other, and some even seem to have started collaborating.`
	planet Siteria
		spaceport `Siteria is the Builder homeworld, both the place where their journey began and where it ended. After a dozen millennia of underpopulation due to its closeness to the Quarg ring, the Ka'het invasion forced them to retreat. As one of the few remaining planets capable of sustaining farming and by far the one with the best climate, for a few centuries it had again the highest number of inhabitants of all the Builders planets.`
		spaceport `	The large number of fields and farms around the planet allowed the Builders to survive for centuries, hiding in sparse strongholds and citadels. Almost three hundred years passed before the Ka'het were able to destroy the last colony.`
	planet Veliante
		spaceport `Incidentally, Veliante was one of the worlds that suffered the heaviest damage during the Ka'het invasion. Here one of the earliest attacks hit some sort of advanced nuclear facility, starting a meltdown; the fallout quickly spread across most of the planet, leaving all Builder settlements uninhabitable.`

mission "Ringworld Debris"
	invisible
	landing
	on enter "Queri"
		set "ringworld debris"
		conversation
			`When you enter this suspiciously empty system, your attention is drawn to your ship's scanners. The proximity detection system is going off, suggesting that something sizable is close to your ship, although whatever it is you can't see it as you look out your cockpit.`
			`	You turn your ship around and open the hatch of your cargo hold, catching the object. When you go to inspect it, you see a small, extremely dark piece of debris that almost looks to be covered in vantablack, but it doesn't resemble any alloy you've seen on a spaceship or station, bearing semblance to both a crystal and a metallic structure.`
			scene "scene/ringworld debris"
			`	In one particular corner you see that there is a small, barely recognizable tube, badly damaged but with a few intact wires creeping out. After tinkering a bit with the wires you manage to connect the debris to your ship's secondary power systems. It barely uses any energy at all, but you can feel the air around it starting to get slightly colder.`
			`	You unplug it and store the debris in a separate part of your ship. Maybe some alien species could tell you about it, if you were to bring it to them.`
		fail
	to complete
		never

mission "Ringworld Debris: Remnant"
	invisible
	landing
	source
		government "Remnant"
	to offer
		has "ringworld debris"
		has "First Contact: Ka'het: Remnant 1B: offered"
	on offer
		conversation
			`Do you want to show the Remnant the piece of debris you found in the abandoned, empty system, and ask them what they know about it?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	A group of Remnant researchers quickly come to your ship when you mention you've found an odd piece of technology, but look disapointed and some even frown when they see the debris, as you explain the system you found it and how it reacted to being fed some energy.`
			`	"We've found many fragments like this one drifting in that system over the decades. It could maybe improve our cooling systems, but we could never begin to comprehend how it works," one of them says.`
			`	They say they don't know any more than you do about the object, but ask that you share with them any information on how it works, should you find out.`
				decline

mission "Ringworld Debris: Hai"
	invisible
	landing
	source
		government "Hai"
	to offer
		has "ringworld debris"
		has "First Contact: Hai: offered"
	on offer
		conversation
			`Do you want to show the Hai the piece of debris you found in the abandoned, empty system, and ask them what they know about it?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	You ask around for a bit, and eventually are lead to a workshop where some Hai engineers and shipwrights are gathered.`
			`	"Greetings, human friend! How may we help you?"`
			`	You show them the piece of debris, and they observe it for a bit, but after just a few minutes of handling it they conclude they don't have the necessary equipment to analyze it.`
			`	"Sorry, whatever it is that you've found, it is too advanced a technology for our systems," they say. You thank them for their time, and head back to your ship.`
				decline

mission "Ringworld Debris: Coalition"
	invisible
	landing
	source
		government "Coalition" "Heliarch"
	to offer
		has "ringworld debris"
		has "Coalition: First Contact: done"
	on offer
		conversation
			`Do you want to show the members of the Coalition the piece of debris you found in the abandoned, empty system, and ask them what they know about it?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			`	After asking around, you're directed to a large Heliarch building, where several of them are standing guard, weapons in hand, while others are performing maintenance on a chunk of hull plating. Judging by its size, it may be a warehouse for their weapons and outfits. "Of assistance how may we be, kind visitor?" One of the agents asks.`
			`	You show them the debris, and explain where you've found it. They are shocked when they see it, but don't attempt to perform any tests on it. "A piece of Quarg technology, this is!" they say, asking again for you to explain where exactly you found it, as they make sure to write it all down this time.`
			`	They then say that they have experience with technology they managed to steal from the Quarg during their war, and that the debris is the remnant of a somewhat common component of Quarg equipment. They also note that what you've found has deteriorated much compared to what they have acquired for themselves, and that it most likely can't even reach a fraction of its optimal cooling output.`
			`	You thank them for their time and the explanation, and head back to your ship.`
				decline

mission "Ringworld Debris: Quarg"
	invisible
	landing
	deadline 1
	source
		attributes "quarg"
	to offer
		has "ringworld debris"
		has "Graveyard Label: offered"
		has "First Contact: Quarg: offered"
	on offer
		fail "Ringworld Debris"
		conversation
			`Do you want to show the Quarg the piece of debris you found in the abandoned, empty system, and ask them what they know about it?`
			choice
				`	(Yes.)`
				`	(Not now.)`
					defer
			apply
				clear "ringworld debris"
			`	Walking down the principal, alien-looking hall, you decide to stop one of the few Quarg you see there. "Hello, human. How may I be of service?" the Quarg says. You show it the piece of debris, and ask what it knows about it. It is momentarily stunned when you show the dark piece of technology, calmly taking it into its own hands after recovering. "A fragment of our ships, is what it is. A remnant of part of our equipment. Thank you for returning it to us."`
			`	You continue by telling it about your travels in the section of the galaxy where you found the debris, and asking what it knows of the place and the hostiles that inhabit it.`
			`	"Ah, you encountered the remains of the Builders. Millennia ago, they were a flourishing and thoughtful empire, but hostile contacts forced them to grow fearful and hawkish. Although they never did attack us, they always refrained from accepting our aid, and attempted to relocate a greater distance from us and our ringworld there, in worlds easier to maintain than ones they were closer to."`
			choice
				`	"Who were these hostile contacts?"`
				`	"What happened to the Builders?"`
					goto ka'het
			`	"Long ago, few ships coming from a foreign species had reached that region of space, using some of the wormholes leading there. They belonged to a young race who foolishly decided to attack the Builders instead of learning from them. Their ships were stronger than any vessel the Builders possessed at the time, but were also few enough in number to be destroyed by the Builders."`
			choice
				`	"What happened after that?"`
			label ka'het
			`	The Quarg stops for a few seconds before continuing, as if it was reflecting on something. "For many millennia they grew, developing brilliant pieces of technology. Then, compelled by their past experiences, they began creating weapons not only to defend themselves, but also to retaliate; these 'Ka'het', as they named them, turned on their creators shortly after they were complete.`
			`	"For a few more centuries the Builders lasted, before falling under their very own hubris. Their space is still populated by the Ka'het they gave birth to through the immense facilities they assembled, a being that does not yet possess a vast intelligence." The Quarg bows, still holding on to the piece of debris, and seems to be preparing to walk away.`
			branch pug
				has "main plot completed"
			choice
				`	"What happened to your ringworld in the Graveyard? Was it in the system I found that thing?"`
				`	(Let the Quarg walk away.)`
					decline
			`	For the briefest moment, you see patches of skin all over the Quarg's body radically shift from the usual grey to red and blue, some spots mixing into purple, and you could have sworn you saw some part of the iris on its eyes "open" very slightly.`
			`	After coming back to normal, it ponders for a second, then says, "It was in that system, and it was lost in a war, millennia after the Builders had perished."`
			`	It doesn't seem too inclined on answering any more questions, and swiftly walks away.`
				decline
			label pug
			choice
				`	"What happened to your ringworld in the Graveyard? Was it in the system I found that thing?"`
				`	(Let the Quarg walk away.)`
					decline
			`	For the briefest moment, you see patches of skin all over the Quarg's body radically shift from the usual grey to red and blue, some spots mixing into purple, and you could have sworn you saw some part of the iris on its eyes "open" very slightly.`
			`	After coming back to normal, it ponders for a second, then says, "It was in that system, and it was lost in our war with the despicable Pug. When we tried to resist them. By then, the Builders had been gone for millennia."`
			`	It doesn't seem too inclined on answering any more questions, and swiftly walks away.`
				accept
	on decline
		log "Asked the Quarg about the history of the Graveyard, and have learned about the previous inhabitants of the region, the Builders."
		log "Factions" "Builders" `The Builders inhabited the Graveyard millennia ago, but have since become extinct. They developed some sort of weapon, called the "Ka'het," which stopped obeying their orders and rebelled against them.`
		log "Factions" "Ka'het" `According to the Quarg, the Ka'het were initially a weapon created by the Builders, which then rebelled and led them to extinction. Even in the millennia that passed, they are still being produced in the Graveyard.`
	on accept
		log "Asked the Quarg about the history of the Graveyard. Was told that the ringworld the Quarg had there was lost in their war with the Pug, and have learned about the previous inhabitants of the region, the Builders."
		log "Factions" "Builders" `The Builders inhabited the Graveyard millennia ago, but have since become extinct. They developed some sort of weapon, called the "Ka'het," which stopped obeying their orders and rebelled against them.`
		log "Factions" "Ka'het" `According to the Quarg, the Ka'het were initially a weapon created by the Builders, which then rebelled and led them to extinction. Even in the millennia that passed, they are still being produced in the Graveyard.`
