# Copyright (c) 2025 by Azure
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.


mission "Avgi: First Contact Wait"
	landing
	invisible
	to complete
		never
	source "Republic" "Free Worlds" "Syndicate"
	to offer
		has "Avgi: Twilight Escape 3: done"
	on offer
		event "avgi: first contact timer" 30
		fail

event "avgi: first contact timer"

mission "Avgi: Intro Reminder"
	landing
	name "Visit the Avgi"
	description "See if there's anything you can do for the Avgi Consonance, which is headquartered at <destination>"
	source
		not "Peripheria"
		attributes "avgi" "twilight" "tangled shroud"
	destination "Peripheria"
	to offer
		has "Avgi: Twilight Escape 3: done"
		has "avgi: first contact timer"
	on offer
		conversation
			`	Though you have returned to their space, it's been a while since you've spoken to the leaders of this strange race of aliens. Maybe you should check in with the Avgi government in exile on Peripheria and see if there's anything you can do to help them.`
				accept


# Northern Scouting Mission Chain

mission "Avgi: Thread Activity 1"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Peripheria"
	destination "Outpost Tekis"
	passengers 3
	to offer
		has "Avgi: Twilight Escape 3: done"
		has "avgi: first contact timer"
	on offer
		conversation
			`	Your arrival on the <ship> attracts some notice, as it always does with the Avgi, curious about this interloper from beyond their space. But this time you seem to have been anticipated, for a pair of Avgi wearing hammered copper bangles greet you as you step off the <ship>.`
			`	"Captain <last>, you are, question?" one asks, glancing down at a slate-grey tablet displaying your likeness.`
			choice
				`	"Yep, that's me."`
				`	"Can I help you?"`

			`	"Entreating. First Speaker Prasinos requests your council. You will accompany us, yes?"`
			choice
				`	"Sure, lead the way."`
					goto meeting
				`	"A meeting? What for?"`
				`	"I'm busy at the moment, sorry."`
					defer

			`	The Avgi glances back down at her tablet. "Trepidation. The Speaker seeks to... further the relations of the Consonance with the good Captain, who has proven both... indispensible and generous with their freely-given aid." It rather sounds like the Avgi would like your help.`
			choice
				`	"Sure, lead the way."`
				`	"I'm busy at the moment, sorry."`
					defer

			label meeting
			`	You are marched through the slowly spinning station to a chamber much deeper than where you originally met Prasinos, along with her fellow First Speakers. This time, Prasinos is alone, greeting you outside a room that can only be her office.`
			`	"Greetings. Well met, Captain. I am pleased you could join me today," she says, wings rustling and she slides the door open. "Invitation. Please, come inside. I have much to discuss with you."`
			`	An appraising glance at the interior reveals a well-furnished office, a round room large enough for several people (rather, several Avgi, you suppose) to converse, but not spacious. The wooden paneling and copper trims are perhaps not the greatest of luxuries, but are downright ostentatious compared to the utilitarian construction Peripheria employes most everywhere else. Avgi-style seating rails ring an elliptical table near the back, but a chair more suitable for you has also been added.`
			`	Only then do you realize there is another Avgi seated around the table, his creamy color blending with the pale wooden walls. You recognize him as Lait, the first Avgi you spoke with, one of the scouts that still dares patrol the Twilight. "Salutations. Captain <last>, I am pleased to see you once again."`
			choice
				`	"Likewise."`
				`	"So what's going on?"`
					goto explanation

			`	"Satisfaction. Captain Lait has briefed me personally on your encounter with him, and I have heard similar praise about your conduct from others among us." She looks at Lait. `

			label explanation
			`	"I have called the two of you here in the hope that you, Captain <last>, are willing to help us, and Captain Lait because of his experience surviving in the Twilight. Captain <last>, am I right in my hope that you are as benevolent an alien as your compatriots?"`
			choice
				`	"I'll do what I can"`
				`	"It depends on what you mean by 'help you.'"`


			`	"Relief. I- no, we are grateful for your assistance, Captain. Rest assured that your aid will not be forgotten."`

			`	With that, Prasinos leaves you alone with Lait. He looks excited, and the moment she leaves, he practically leaps off his seat. "Enthusiasm. Captain <first>, I have not had the chance to meet you properly, truly. Our first meeting was in a moment of danger, and I lacked the translation tools to properly communicate, and when I first greeted you in person, it was as an official act. But truly, my hope has been to speak with you more openly, and to hear of the galaxy beyond."`
			choice
				`	"Sure, I can tell you quite a bit about the galaxy."`
					goto galaxy
				`	"Well, I wouldn't say I've explored all that far."`

			`	"But you have your own space, no? You humans, with your star clusters in the north, far larger than all of the Twilight and Tangled Shroud together."`
			choice
				`	"Yes, I suppose so."`
					goto fan
				`	"It isn't really that interesting."`
			`	"Disappointment. Ah well,"`

			label fan
			`	"Excitement. I am a fan, you could say, of you humans. Fascinating aliens, you are!" To your surprise, he then thrums in a deep, hard voice, without the aid of the translator. "Speech of humans, I have learned. Many years practice!"`
			choice


			label galaxy
			`	Lait's wings flicker, faster than your eye can see. "Excitement. Will you tell me then, before we depart? One story about the aliens you've met?"`
			choice
				`	(Tell him about the Hai.)`
					goto hai
				`	(Tell him about the Quarg.)`
					goto quarg
				`	(Tell him about the Wanderers.)`
					goto wanderers
				`	(Tell him about the Korath.)`
					goto korath
				`	(Tell him about the Coalition.)`
					goto coalition
				`	(Tell him about the Archons.)`
					goto archons
				`	(Tell him about the Pug.)`
					goto pug
				`	(Tell him about the Bunrodea.)`
					goto bunrodea
				`	(Tell him about the Incipias.)`
					goto incipias
				`	(Tell him about the Successors.)`
					goto successors
				`	(Tell him about the Gegno.)`
					goto gegno
				`	(Tell him about the Rulei.)`
					goto rulei
				`	(Tell him about the Avgi.)`
					goto avgi


			label avgi
			`	You explain how, in your travels, you met an alien race under assault from powerful enemies, forced to flee into a labyrinth of hyperlanes. Lait listens curiously at first, then realizes what you're doing and flicks his wings in laughter. "Amusment. A fine joke, Captain <first>, but you owe me a real story later!"`


			label ship
			`	"It is unfortunately under repair. Took a nasty hit from an Aberrant Spiker last week, it did."`
			choice
				`	"Spiker?"`
				`	"That's alright."`
					goto ship

			`	"Explanation. The... projectiles certain Aberrant can extrude, the ones that track and chase you. Embarassment. Well, they look like spikes," he says, wings flicking. "We don't really know what they are or how they work, but they certainly can tear through armor like it's paper."`

			label ship




			`	As you land on Peripheria, Prasinos asks to see you. She introduces you to Lait. Stuff is happening in Thread.`
			accept

	on enter "Thread"
		conversation
			`	The Thread system is whirling with asteroids`


			`	"Consideration. Anything suspicious in space, we investigate. We have reports from Optikons - our remote probes - of radio emissions in frequency bands popular with the local asteroid miners. Most of them evacuated with us to the Tangled Shroud, and we thought the rest were lost to the Aberrant, but it seems that there might be survivors."`

			`	Lait points out some stuff in the system. Notes that the asteroid miners probably have hideouts everywhere.`

	npc assist
		government "Avgi"
		personality derelict mute pacifist target
		system Whirlwind
		ship "Akoustiki" "Solid Rain"
		conversation
			`At first glance, the ship appears derelict, with no sign of any active systems and minimal thermal emissions. But as you dock with it, `

			`	As you poke your head inside, you feel a cold, hard object pressed against the side of your head. "Warning. Think fast, Captain."`
			choice
				`	"Whoa, calm down."`	
				`	(Try the cool karate move again.)`
					to display
						has "FW Katya 1: declined"






			`Talk to Ercu and Corsa Here`


			`	Our asteroid station was destroyed by the Aberrant`
			`	Do you want to be taken to another asteroid station?`
			`	No, it isn't safe here, and we don't know how to find them`
			`	What about the planet below?`
			`	No, our parents always told us the planet dwellers weren't our friends`
			`	Dissonance station instead`

 

				depart


mission "Avgi: Thread Activity 2A"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Outpost Tekis"
	destination "Peripheria"
	passengers 3
	to offer
		has "Avgi: Intro Reminder: done"
	on offer
		conversation
			`	Take Ercu and Corsa back to Peripheria.`
			accept

	on enter "Thread"
		conversation
			`	Lait points out some stuff in the system. Notes that the asteroid miners probably have hideouts everywhere.`

mission "Avgi: Thread Activity 2B"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Outpost Tekis"
	destination "Peripheria"
	passengers 3
	to offer
		has "Avgi: Intro Reminder: done"
	on offer
		conversation
			`	Take Ercu and Corsa back to Outpost Enka.`
			accept

	on enter "Thread"
		conversation
			`	Lait points out some stuff in the system. Notes that the asteroid miners probably have hideouts everywhere.`




mission "Avgi: Amathil Contact 1"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Peripheria"
	destination "Amathil"
	to offer
		has "Avgi: Twilight Escape 3: done"
	on offer
		conversation
			`	Go to Amathil and bring a communique to their leaders.`
			accept


mission "Avgi: Amathil Contact 2"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Amathil"
	destination "Peripheria"
	to offer
		has "Avgi: Amathil Contact 1: done"
	on offer
		set "avgi: contacted planets"
		conversation
			`	Talk to the Amathil government people. Get their side of the story about being left behind, though they're pleasant and cordial with the Consonance, then return to Peripheria`
			accept


mission "Avgi: Aviskir Extraction 1"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Peripheria"
	destination "Aviskir"
	to offer
		has "Avgi: Amathil Contact 2: done"
	on offer
		conversation
			`	"The Consonance relinquished its claim to represent us when they fled into the night and abandoned us to the mercy of the Aberrant" he growls out.`




			`	Make contact with the Aviskir government with some Consonance documents and seals. Extract a VIP nuclear weapons scientist from Aviskir. She is already occupied with another project and refuses to leave`
			accept

mission "Avgi: Aviskir Extraction 2"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Aviskir"
	destination "Peripheria"
	to offer
		has "Avgi: Aviskir Extraction 1: done"
	on offer
		conversation
			`	Return to Peripheria`
			accept


mission "Avgi: Araio Wrangling 1"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Peripheria"
	destination "Araio"
	to offer
		has "Avgi: Aviskir Extraction 2: done"
	on offer
		conversation
			`	Go to Araio and retrieve a lockbox with some data`
			accept

mission "Avgi: Araio Wrangling 2"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Araio"
	destination "Elthe"
	to offer
		has "Avgi: Araio Wrangling 1: done"
	on offer
		conversation
			`	Pickup the stuff on Elthe`
			accept



mission "Avgi: Araio Wrangling 3"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Elthe"
	destination "Peripheria"
	to offer
		has "Avgi: Aviskir Extraction 2: done"
	on offer
		conversation
			`	Return the special data to Prasinos`
			accept



mission "Avgi: Aviskir Repatriation"
	landing
	name "Placeholder"
	description "Placeholder"
	source "Peripheria"
	destination "Araio"
	to offer
		has "Avgi: Aviskir Extraction 2: done"
	on offer
		conversation
			`	A couple wants to be taken to Aviskir, where they have family. Talks about how life is better there`
			accept



# Ask for Help Mission Chain






mission where you pick up human hyperspace relays from a syndie world


place a few at the outer limits to link up the systems

then you go place them at various systems to connect ensemble to arche, to test if the shrangled toud interferes



















# Investigate the Aberrant Mission Chain



mission "Avgi: Aberrant Investigation Pointer"
	landing
	name "Meet the Astronomer"
	description "Go to <destination> to meet with an Avgi astronomer who claims her work is critically important."
	source
		not "Ergastirio Station"
		attributes "avgi diaspora"
	destination "Ergastirio Station"
	to offer
		has "Avgi: Araio Wrangling 3: done"
	on offer
		dialog `	You find a message waiting for you, with an Avgi astronomer requesting a meeting at <destination>, claiming her work is key to fighting the Aberrant. You wonder what interest an astronomer could have in you, or how astronomy is even relevant to the war with the Aberrant.`
			accept


mission "Avgi: Alonis Retrieval 1"
	landing
	name "Visit the Alonis Observatory"
	description "Cerise is attempting to study the region of space the Aberrant came from. Reach the <destination> and retrieve astronomical data from its computer, if it remains intact."
	source "Ergastirio Station"
	destination "Alonis Observatory"
	to offer
		has "Avgi: Araio Wrangling 2: done"
	on offer
		conversation
			`	Your contact is waiting for you, a vivid pink Avgi named Cerise, who quickly escorts you to her rather cramped office. "Warm greetings. Thank you for taking the time to meet with me, Captain <last>.`
			choice
				`	"It's no trouble."`
					goto next
				`	"I'm curious about what astronomy has to do with the Aberrant."`
					goto astronomy
				`	"This better be important."`

			`	She looks a bit crestfallen at your tone. "Assurance. It is, I promise! Just hear me out."`
				goto next
			
			label astronomy
			`	"Discomfort. You sound like the Assembly, you know, when they ask why they should keep paying me. But I promise, this is important!"`

			label next
			`	She wobbles on her perch a bit. "Well, I suppose I should get to the point. That's what everyone is always telling me. Explanation. You see, I am a scientist, but not one that works on weapons or spaceships or anything like that. That's more of my brother Cerul's line of work. But astronomy can be important too!"`
			`	She continues to ramble a bit about the critical importance of large telescopes in discovering new worlds and physical phenomena. "But in this case, you know, I worked on this big space telescope we had back in our home cluster, in the Pinnacle system. The Alonis Observatory, a station with one of the biggest optical scopes ever, plus a whole bunch of other instruments. Enthusiasm. You really should have been there for the construction, I hear they had to modify a whole custom freighter just to ship the primary mirror segments in. And then they accidentally cooked one with a careless torch burn, hehe."`
			choice
				`	(Let her continue without interrupting.)`
				`	(Tell her to get to the point.) "So what does this telescope have to do with anything?"`
					goto thepoint

			`	"Recollection. And then there was that time Chiffon, he was a friend of mine, he cooked a star tracker by pointing it at the local primary. Right at it, a shot in a million, and no one could ever figure out why the safety locks were turned off."`
			`	After a while your eyes start to glaze over. "...and like I said, we built Alonis because a group of fellow polities wanted to really explore the systems to our east, but the ion storms would just cook our scout ships, and we couldn't figure out why, seeing as none of them returned. So we built this observatory in the closest system we could, to look at them from a distance, see what was going on. That was how we discovered the ion storms in the first place, despite having lost so many ships to them. And that area, the Ember Waste, that's where the Aberrant came from!"`
				goto end

			label thepoint
			`	"Embarassment. Anyway. The Alonis Observatory was built by a coalition of polities with an active interest in exploration, because the systems to our east were too hostile to actually explore with our ships at the time. Strange ion storms that would cook our scout ships, before we layered them with armor and shielding. Not the shields you humans invented, I mean, just your typical radiation shielding for charged particles, you know, a bunch of polyethylene and water and tungsten...." You cough politely before she can keep going. "Well, I mean, those systems, you know, ended up being the same systems the Aberrant came from."`
			`	Cerise finally brings up a map of eastern Avgi space on the wall. "Vindication. And that's why astronomy is important! We monitored those systems for years, and after we finally got scout ships there, we looked at the systems beyond. The same area we think the Aberrant came from - the Ember Waste."`

			label end
			choice
				`	"So... where do I come in?"`
					goto actualend
				`	"And did you ever observe anything interesting there?"`

			`	"Oh, all sorts of interesthing things! Habitable worlds, for one, which had people just hovering to get there. And some odd light curves that really looked a lot like some kind of megastructure around the star, but that was before we were really sure about the Antecessors existing."`
			choice
				`	"The Antecessors?"`
				`	"So... where do I come in?"`
					goto actualend

			`	"Consideration. No one really knows who they were. But once we were able to get hardened scout ships into the Ember Waste, we found all sorts of evidence that a past civilization had once existed there. Depleted minerals, layers of old plastics and radioisotopes, even some ancient hunks of metal that were once satellites. But if that light curve really is from some megastructure, it could be from an entirely different civilization, who knows?"`

			label actualend
			scene "alonis observatory picture"
			`	Cerise waves an arm at the wall, which changes to display a grainy image. "A scout ship imaged the Observatory a few weeks ago, during a daring run to the Pinnacle system." She jumps excitedly on her perch. "Enthusiasm. You can see that the station is still intact, no? I want to go and retrieve all of the data still on board, of course. We usually just processed most of it on-site, with how expensive it was to get couriers to ship the memory pebbles back to Anax, so the bulk of the raw data is still there."`

			choice
				`	"Okay, let's go."`
					goto actualendfinalv2(1)_
				`	"I've actually been to those systems. They're inhabited by aliens called the Ka'het, which look a bit like the Aberrant."`
					goto graveyard
					to display
						has "Graveyard Label: offered"
				`	"You know I can just take you to those systems?"`
			`	She just stares at you for a moment "Consideration. I would like to agree, as that would be an excellent adventure, but it isn't those further systems I care about, actually."`
				goto actualendfinalv2(1)_

			label graveyard
			`	You explain to Cerise about the Builders and Ka'het, and how they look suspiciously similar to the Aberrant. "Awe. If that could truly explain the origin of the Aberrant, we need this data more than ever."`

			label actualendfinalv2(1)_
			`	She brings up a map of a cluster of systems just east of Avgi space. "I want to retrieve the full observation record for the systems our scouts explored, just before the Incursion. The story is that some kind of gateway or portal activated, which let the Aberrant in, and I want to see if there's any record of a similar activation happening in the years before that."`
			`	"Excitement. The Alonis Observatory was more or less ignored by the Aberrant, as far as we know, and the onboard memory should still have all of the records I want. All we need to do is sneak onto it, without any Aberrant in the system, and transfer the data! Easy!"`
			choice
				`	"Alright, let's go."`
					accept
				`	"This is too dangerous for me. I'm out."`
					decline

	npc evade
		government "Aberrant"
		personality coward secretive staying vindictive waiting uninterested
		fleet
			names "aberrant names"
			variant
				"Aberrant Hugger" 2
				"Aberrant Whiskers"

	on stopover
		dialog `	You dock at the <planet>, but Cerise doesn't want to proceed from there. "Uncertainty. I can't work with those Aberrant still out there; they could damage the Observatory. See if you can kill them or get them to run away."`


mission "Avgi: Alonis Retrieval 2"
	landing
	name "Return to Ergastirio Station"
	description "Take the data back to Ergastirio Station so that Cerise can go over it."
	source "Alonis Observatory"
	destination "Ergastirio Station"
	to offer
		has "Avgi: Alonis Retrieval 1: done"
	on offer
		conversation
			`	The station is dark, but appears to be largely unscathed. "Puzzlement. I wonder why the Aberrant spared Alonis, unlike most of the stations they came across."`



mission "Avgi: Astronomical Cross Referencing 1A"
	landing
	name "Quarg Astronomy"
	description "See if the Quarg will provide records of their observations of the Ember Waste."
	source "Ergastirio Station"
	destination "Lagrange"
	to offer
		has "Avgi: Alonis Retrieval 2: done"
	on offer
		conversation

mission "Avgi: Astronomical Cross Referencing 2A"
	landing
	name "Quarg Astronomy"
	description "See if the Quarg will provide records of their observations of the Ember Waste."
	source "Lagrange"
	destination "Ergastirio Station"
	to offer
		has "Avgi: Alonis Retrieval 2: done"
	on offer
		conversation


mission "Avgi: Astronomical Cross Referencing 1B"
	landing
	name "Remnant Astronomy"
	description "See if the Remnant will provide records of their observations of the Ember Waste."
	source "Ergastirio Station"
	destination
		government "Remnant"
		attributes "remnant primary"
	to offer
		has "Avgi: Alonis Retrieval 2: done"
	on offer
		conversation

mission "Avgi: Astronomical Cross Referencing 2B"
	landing
	name "Remnant Astronomy"
	description "See if the Remnant will provide records of their observations of the Ember Waste."
	source "Ergastirio Station"
	destination
		government "Remnant"
		attributes "remnant primary"
	to offer
		has "Avgi: Alonis Retrieval 2: done"
	on offer
		conversation









# Cryopod Mystery Mission Chain


mission "Avgi: Lost Freighter 1"
	landing
	name "Lost Freighter"
	description "Find a derelict freighter spotted in the Tangled Shroud near the <system> system."
	source
		not "Ergastirio Station"
		attributes "avgi diaspora"
	destination "Ergastirio Station"
	to offer
		has "Avgi: Araio Wrangling 3: done"
	on offer
		dialog `	You find a message waiting for you, with an Avgi astronomer requesting a meeting at <destination>, claiming her work is key to fighting the Aberrant. You wonder what interest an astronomer could have in you, or how astronomy is even relevant to the war with the Aberrant.`
			accept







# Strike Force Mission Chain






