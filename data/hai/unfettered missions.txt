# Copyright (c) 2021 by Hurleveur
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.  See the GNU General Public License for more details.



mission "Unfettered: Bring Hai"
	name "Bring new true Hai back"
	description `Bring <bunks> Hai from <stopovers> to <origin>.`
	blocked "You will need room for 10 passengers in order to take on an Unfettered mission."
	passengers 10
	to offer
		has "Unfettered Jump Drive 1: offered"
	source "Firelode"
	stopover "Snowfeather"
	on offer
		conversation
			`As you exit your ship you notice a group of Unfettered together in the spaceport, in a big yet simple squared-shape stadium. They seem to be discussing something of importance.`
			choice
				`	(Go see them.)`
				`	(Ignore them.)`
					decline
			`You start moving their way and you notice one of them separates from the rest to come your way and seems to be rumbling on about something,	"We do not get alien visitors often here. There has to be a reason for your presence..."	The Unfettered seems a bit lost in his thoughts. When he speaks again is it with renewed focus,	"Sorry, I was thinking out loud ! Well you are here so maybe you could help us."`
			`	"We have friends outside of our space, civilians and others. We would do anything to help a friend, and some Hai contacted us : they want to join us. I can only hope you are willing to help us reunite with our brothers and sisters from Hai space,"	he says. He seems a bit desperate.`
			choice
				`	"Of course, what do you need me to do ?"`
					goto action
				`	"What do you mean, brother and sisters from Hai space ? Are you not different ?"`
					goto brethren
				`	"Why do you need me to do it ?"`
				`	"This seems like a bad idea, ask someone else."`
					decline
			label whyme
			`	"The Hai are preventing us from reaching out to anywhere in space, as you have probably noticed they have a fleet at the edge of our system. And not many Hai captains are willing to bring them here, because of the obvious risks involved, they could get killed in the cross fire. Yet you somehow made your way here, probably under fire from our own people, but now that we are allied you should not have any issues getting out of here. So, are you willing to help us ?"`
			choice
				`	"Of course, what do you need me to do ?"`
					goto action
				`	"This seems like a bad idea, ask someone else."`
					decline
			label brethren
			`	"Then you have heard about the stories of the Drak modifying our people..."	He seems a bit sad.	"I do not believe in such things, what makes a Hai -or any other specie- “True” is in his heart. It will take him wherever he wants to go."	He pauses a bit, thinking, then he speaks again, with deep conviction,	"Even if we war the Hai it does not mean we hate them or them us, we only do it because we have to. We can still communicate with our people, and eventually they will all be freed from the limits the Hai government imposes upon them."`
			choice
				`	"Will this get me into any trouble with the Hai ?"`
				`	"What limits ?"`
					goto limits
				`	"Why do you need me to do it anyway ?"`
					goto whyme
				`	"I believe they would not have their place here, I will not bring them."`
					decline
			`	"Quite the contrary ! They may not believe in our way of doing things, but they would never dare restrict the movement of their own people. It would be against all they stand for. Even if we behave differently they know we are still Hai, and that we would never hurt civilians of our own race."	He seems confident.`
			choice
				`	"What is it exactly you want me to do ?"`
					goto action
				`	"I am not interested in moving people around."`
					decline
			label limits
			`	"I mean that they are prevented from reaching their true potential. Once we had most of the stars but since and some of us have decided to stop changing, to stay peaceful, with all species, no matter how primitive. They have chosen to decay, to grow soft. We are the ones who choose to find our legacy, to evolve, to grow."`
			choice
				`	"What is it exactly you want me to do ?"`
				`	"I am not interested in moving people around."`
					decline
			label action
			`	"Oh it is pretty simple, you only need to go to Snowfeather, pick up <bunks> Hai and bring them here."`
			choice
				`	"I will get to it right away then."`
					accept
				`	"I do not want to bring you Hai defectors, sorry."`
					decline
	on stopover
		dialog `The Hai seem happy to get on your ship, now return to <origin> with them.`
	on visit
		dialog phrase "generic passenger on visit"
	on complete
		payment 100000
		log `Helped some Hai to join the unfettered.`
		dialog `The Unfettered thank you for bringing these "soon True" Hai back, and give you <payment>.` #The Unfettered elder has left you a message, "If you want to help us again, the hospitals on Darkcloak are in grave need of resupply."`



mission "Unfettered: Prove your strength"
	name `Defeat the warlord`
	description `A young Unfettered warlord has provoked you in a duel, disable his ship.`
	source "Darkcloak"
	to offer
		has "Unfettered Jump Drive 2: offered"
	on fail
		dialog `You have failed an essential unfettered mission. You may want to reload.`
	on offer
		conversation
			`You start wandering in the spaceport, and notice that everything around here is so... simple, efficient, ordered. There seems to be more warriors here than on the other unfettered planets, or at least they are less affrayed to wonder around with their weapon, they seem ready for action at any time, you are happy not to be their enemy, or at least, for now.	As you continue walking you notice someone speaking to a crowd of people. They seem very familiar with each others, and it seems they have noticed you too, the one who was adressing the others approaches you.`
			`	"This is the monkey you speak so highly off ? The one who fears not to come into our space, to fight our ships ?"	He asks the others, apparently mocking you. This could get you into trouble.`
			choice
				`	"I fear nothing. Do you ?"`
					goto provoke
				`	(Say nothing.)`
				`	(Run away.)`
					decline
			`	"See ? The monkey dares not speak ! He would not stand a chance in combat, our modest ship would bring him straight out of the sky, but we should not even try or we could hurt it. But my friends, there is no shame for him to have... With a ship looking like that one I would be hesitant to fight too !"	He seems very full of himself, maybe you should teach him a lesson.`
			choice
				`	"How dare you call the <ship> ?"`
				`	"I have no need to prove myself to a rodent."`
				`	(Go, he is not worth it.)`
					decline
			label provoke
			`	"So the monkey can speak, let us see if it can fight as well !"	He seems very full of himself, time for his lesson. Or perhaps you are the one who needs to learn humility... After a cheering from his crowd, he speaks to you, directly this time,	"You and me, in battle, leave your fleet parked. Meet me in the sky when you are ready, except if you lack the courage to fight me. This is not to be a fight to the death, monkey."`
			choice
				`	"Let me show you my worth, in battle, right now."`
					accept
				`	(Run away.)`
					decline
	npc save disable
		government "Hai (Unfettered Challenge)"
		personality disables staying heroic target
		fleet
			names "hai"
			variant
				"Lightning Bug (Pulse)"
		conversation
			`Now that you have disabled the <npc> its captain hails you.	"It seems you fight well, you have earned my respect today." He says`
			choice
				`	"Be careful with provoking me, you may have gotten killed. Do not count on me to repair your ship."`
					goto dangerous
				`	"What was this really about ?"`
			`	"You have earned the right to know. We Unfettered always seek to improve ourselves, be it in combat or otherwise. You come from far away, we do not have many strangers around here, and I wanted to find out new tactics."`
			choice
				`	"You could have just asked."`
			`	"One cannot learn much from words only, and I was not sure how you would react. That is why I provoked you."	One of his crew tells him something you do not understand. "Well that, and maybe I was a bit too prideful and accepted a challenge I should not have."`
				goto end
			label dangerous
			`	"Worry not, my respect is only to be earned once."`
			label end
			`	"Hopefully we see each other again, sometime."	He and his crew seem quite busy with the repairs.`
	on complete
		payment 25000
		log `Tought a lesson to a young Unfettered warlord.`
		dialog `You receive a message from the <npc> : "Hopefully these <payment> credits will be enough to repair any damage I may have done to your ship."`



mission "Unfettered: Prove your strength 2"
	name `Get jump drives`
	description `Go to the pirate world of <destination> and recover jump drives from a vault.`
	source "Darkcloak"
	destination "Freedom"
	blocked "You will need 80 cargo space in order to take the next Unfettered mission."
	cargo "(reserved)" 80
	to offer
		has "Unfettered: Prove your strength: done"
		has "Unfettered Jump Drive 3: offered"
	on offer
		conversation
			`As you go near what seems to be a bar in the spaceport you find the same Hai that challenged you. "So we meet again, he ? It will take a lot more than what you did last time if you want to take me down this time ! But that is not why I am here," he says, apparently happy to see you.`
			choice
				`	"What is the job about ?"`
					goto job
				`	"Sure, I would do anything for my favourite squirrel !"`
					goto insult
				`	"Oh just admit it, you are scared."`
				`	"I am not interested in helping you."`
					decline
			`	"Nice try but I have learned my lesson. Soon I will have a bigger ship though, and when I do I will be glad to accept that challenge ! A lot of times, having the bigger guns is all the strategy, and diplomacy that is needed."`
			choice
				`	"What can I do for my favourite squirrel ?"`
					goto insult
				`	"How soon ?"`
				`	"Well just do it with that bigger ship then, I am not interested."`
					decline
			`	"As soon as the end of this job, hopefully ! It should pay well. New ship kind of well."`
			choice
				`	"What kind of job is it ?"`
					goto job
				`	"Good luck getting your ship without my help."`
					decline
			label insult
			`He does not seem to react to the insult. He did call you monkey a few times before, so it is only fair to return the courtesy.`
			label job
			`	"We are going to collect a few jump drives ! Normally you would not be able to get such a job because it requires trust, but I have gotten it for you, meaning officially this is my mission, and a very lucrative one at that !"`
			choice
				`	"Okay... It seems too good to be true, what is the catch ?"`
				`	"Well if this is your mission you just do it yourself."`
					decline
			`	"Well... The name of the world is freedom, and whilst it may sound nice, it is a pirate world, that is why I need your ship for transportation trough Hai space. You will also need to have cargo space available for 4 jump drives."`
			choice
				`	"Let's go then !"`
					goto leave
				`	"Why can you not just use a jump drive and go there yourself ?"`
				`	"What will my cut be ?"`
					goto cut
				`	"Sorry I will not risk my ship by going anywhere close to these pirates."`
					decline
			`	"Jump drives are a very prized possession among my people, I would not risk one by travelling trough hostile space. You had access to a jump drive yet you do not know about the hostiles to the South ? The wanderers would not be very happy to see me either..." it seems like you disappointed him a bit.`
			choice
				`	"Let's go then !"`
					goto leave
				`	"Sorry I will not risk my ship by going anywhere close to these pirates."`
					decline
			label cut
			`	"You humans always seem obsessed with money... It will be a lot... really a lot !"`
			label leave
			`	"One last thing : We should not go there by jump drive, it would only attract unwanted attention to us, especially considering where we are going. It would not be of a big advantage anyway considering I do not want to travel trough wanderer space."`
				accept
	on visit
		dialog phrase "generic missing stopover or cargo"
	on fail
		dialog `You have failed an essential unfettered mission. You may want to reload.`



mission "Unfettered: Prove your strength 3"
	name `Bring jump drives back`
	description `Go back to <destination> with the jump drives.`
	source "Freedom"
	destination "Darkcloak"
	landing
	invisible
	on offer
		conversation
			`Following the advice of the Hai, you park your ship close to the hidden depot in case something goes wrong, and then follow the Hai outside.`
			choice
				`	"Who made this vault, what should I expect ?"`
				`	(No time for talking.)`
					goto outside
			`	"As you know once in the past, our ancestors had a great empire. This vault was a part of that empire, and is well protected, so there could not be too big of a fight ahead,"	he assures you.	He is fully armoured, so as long as you stay with him, everything should be fine.`			
			label outside
			`Before exiting, he warns you,	"Do not try anything stupid, and stay behind me."	He seems worried and keeps looking around, without making a sound.`
			choice
				`	"Is everything alright ?"`
				`	"There is no need to be worried, that cache is well hidden."`
				`	(Keep walking, ready to reach for my gun.)`
					goto discrete
			`You are not sure what kind of sign he just did, but it seems pretty clear he wants you to keep quiet. Looking around, you notice you two have attracted quite a bit of attention from the local, but while they seem to have nothing to lose, you also notice that a lot of them are very young, and probably not as bad as the republic propaganda can make people think.`
			label discrete
			`The closer you get to the cache, the more you get the impression that it is no small depot, you see some security turrets around. You notice a door. It looks like the vault is underground. Suddenly, the Hai stops.`
			choice
				`	(Stay behind the Hai.)`
					goto stay
				`	(Go to the door.)`
			`As you reach for the door the Hai cries something, probably trying to warn you, but it is too late. You have already triggered the security systems, and are ripped to shreds by the turrets.`
				die
			label stay
			`The Hai reaches for something in his pocket, resembling a command device, and enters what you assume to be the access codes. It does not seem to be working very well by the look on his face...	"Someone else has had access to the vault, this was not expected,"	he says. His grip on his weapon tightens, and he equips his helmet, he is now in full armour.	"Stay here, I will take care of it," he says.`
			choice
				`	"I will not cower away while you do all the heavy lifting. I am coming with you."`
					goto fight
				`	(Do as he says.)`
			`While it felt like the right thing to do at the time, you quickly realise separating and then staying here in the open is quite stupid. It is too late unfortunately, because you get stabbed by a local pirate, that is no longer impressed by your friend.`
				die
			label fight
			`He sighs,	"as you wish, but I hope you can take care of yourself. I have disabled the automated defences just in case they were hacked. We just have to go in, make sure they recognize us as friends and then reactivate them."	You both enter the vault.`
			`At first you do not notice anything suspicious, but as you get used to the low luminosity you notice a flash of light, on your left, quite far.`
			choice
				`	(It is just a light flicking, no need to worry.)`
				`	"GET DOWN !"`
					goto down
			`It was indeed just a light flicking. A s-n-i-p-e-r light, used to acquire a target : you.`
				die
			label down
			`You get down as you give the warning, then look at him. He was evidently trained for this, as you shout he does not hesitate, or ask any questions but promptly jumps to the side. Once in position he fires his rifle. You are impressed by the precision of that weapon, but are not sure why he decides to shoot 3 more times, even though the sniper was already KO on the first shot.`
			`After looking all over the vault to find other surprises, the area is declared cleared, any other enemies have probably run off seeing the Hai. You then run the necessary tests on the jump drives whilst he takes care of the security systems.`			
			choice
				`	(Go back to the ship.)`
					goto ship
				`	"We could have just come into the vault swarming with ground forces instead of risking our lives..."`
				`	"Why did we have to go into the vault instead of just connecting it to the ship earlier ?"`
					goto vault
			`	"As you have probably noticed we have not had access to this vault in a long time, some pirates could have sneaked in and sabotaged the jump drives to cripple your ship, or worse."`
				goto ship
			label vault
			`The point to all of this was to be discrete, jump drives are worth a lot on the black market.`
			choice
				`	(Go back to the ship.)`
					goto ship
				`	"If this world is so wild, why put the jump drives here in the first place ?"`
			`	"The Unfettered are not the ones who placed those jump drives here..."`
			label ship
			`You go back to your ship with the Hai, and give the orders to collect and install them.`
			`A bit later the Hai comes to speak to you on the bridge.	"It took us too long to install the jump drives, we seem to have attracted attention. I guess that if some of the pirates got away from the vault, they have contacted some friends..."	As you look outside you see multiple ships getting ready to launch far away. You should launch as soon as you can.`
				accept
	on accept
		"outfit" "Jump Drive" 4	
	npc
		government "Pirate"
		personality plunders waiting
		fleet "Large Northern Pirates"
		fleet "Small Northern Pirates"
	on visit
		dialog phrase "generic missing stopover or cargo"
	on fail
		dialog `You have failed an essential unfettered mission. You may want to reload.`
	on complete
		payment 3000000
		outfit "Jump Drive" -4
		log `Helped a young unfettered warlord to bring jump drives from a pirate world.`
		dialog `"Here is your share : <payment>. You have saved my life, captain <first>, and I shall never forget it. You have earned the right to know my name : "Si-Ra". Come see me again soon if you are up for a challenge."`
		log "People" "Si-Ra" `A young impetuous Unfettered warlord who seems to grow wiser by the day. He has impressive leading and combat skill, and seems to be a fan of getting bigger and bigger ship. He always leaves room for improving tactics.`