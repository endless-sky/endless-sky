# Copyright (c) 2022 by Hurleveur
#
# Endless Sky is free software: you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later version.
#
# Endless Sky is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <https://www.gnu.org/licenses/>.

ship "Sea Scorpion" "Sea Scorpion (Shields, Trackers)"
	outfits
		`"Biroo" Atomic Steering`
		`"Biroo" Atomic Thruster`
		"Boulder Reactor"
		"Bullfrog Anti-Missile" 2
		"Hai Diamond Regenerator" 4
		"Hai Ravine Batteries"
		"Hai Tracker" 224
		"Hai Tracker Pod" 4
		"Hai Williwaw Cooling"
		Hyperdrive
		"Outfits Expansion" 2
		"Pulse Rifle" 15
		"Value Detector"

fleet "Sea Scorpion Challenger"
	government "Hai (Unfettered Challenger)"
	names "hai"
	personality disables plunders staying timid target
	variant 5
		"Sea Scorpion (Pulse)"
	variant 3
		"Sea Scorpion (Shields, Trackers)"
	variant 5
		"Sea Scorpion (Ion)"
	variant
		"Sea Scorpion (Ionic)"
	variant 2
		"Sea Scorpion (Shredder)"

fleet "Shield Beetle Challenger"
	government "Hai (Unfettered Challenger)"
	names "hai"
	personality disables plunders staying timid target
	variant 5
		"Shield Beetle (Pulse)"
	variant 5
		"Shield Beetle"
	variant 5
		"Shield Beetle (Tracker)"
	variant
		"Shield Beetle (Ionic)"
	variant
		"Shield Beetle (Sunbeam)"
	variant
		"Shield Beetle (Thunderhead)"

event "unfettered: challengers arrive"
	system "Wah Yoot"
		add fleet "Shield Beetle Challenger" 5000
		add fleet "Sea Scorpion Challenger" 7500
	system "Ehma Ti"
		add fleet "Sea Scorpion Challenger" 7500
		add fleet "Shield Beetle Challenger" 7500
	system "Hi Yahr"
		add fleet "Sea Scorpion Challenger" 5000

event "unfettered: challengers leave"
	system "Wah Yoot"
		remove fleet "Shield Beetle Challenger"
		remove fleet "Sea Scorpion Challenger"
	system "Ehma Ti"
		remove fleet "Sea Scorpion Challenger"
		remove fleet "Shield Beetle Challenger"
	system "Hi Yahr"
		remove fleet "Sea Scorpion Challenger"



mission "Unfettered: Challengers Arrive"
	landing
	invisible
	source "Darkcloak"
	to offer
		has "Unfettered: Prove Your Strength: done"
	on offer
		dialog `The Captain meets you in the starport now that his crew done patching up his ship. "She'll fly again, alright. Now that ye know how a duel rolls, many Unfettered may want to challenge you, depending on your fame. If you agree, they won't think twice about engaging you once you get too close, and will be marked on your map, because that's how they want ye to see them! In that case, be carreful not to run around with too big of a fleet, or there may be some unwanted casualties, and we wouldn't want that now, would we? Do you feel ready for the challenge? If ye refuse, do know ye can always mark yerself as ready for action from the job board, only from here on Darkcloak. The opposite holds true too, if ye do not feel like fighting ye can mark yerself not ready! So, what do you say?"`
	on accept
		event "unfettered: challengers arrive"

mission "Unfettered: Trigger The Challengers"
	job
	name "Ready for more challengers"
	description "Mark yourself as ready for more challengers to come in all Unfettered systems."
	source "Darkcloak"
	to offer
		has "Unfettered: Prove Your Strength: done"
	to fail
		has "Unfettered: Trigger The Challengers: active"
	on accept
		clear "event: unfettered: challengers arrive"
		event "unfettered: challengers arrive"
		dialog "Even more challengers will come, hopefully you are ready for them!"

mission "Unfettered: Remove The Challengers"
	job
	name "No more challenges"
	description "Mark yourself as no longer wanting to do challenges in any Unfettered systems."
	source "Darkcloak"
	to offer
		has "Unfettered: Prove Your Strength: done"
		has "event: unfettered: challengers arrive"
	to fail
		has "Unfettered: Remove The Challengers: active"
	on accept
		clear "event: unfettered: challengers arrive"
		clear "event: unfettered: challengers leave"
		event "unfettered: challengers leave"
		dialog "No more challengers will come by themselves in space. You can still change your mind by accepting the other job, or any specific duelling job."



# to make sure you are always hostile to the challengers, otherwise shooting them means provoke meaning it will agro Unfettered
mission "Hostile Challengers"
	landing
	invisible
	to offer
		has "reputation: Hai (Unfettered Challenger)" > -100
	on offer
		"reputation: Hai (Unfettered Challenger)" <?= -10000



phrase "unfettered challenger defeated"
	word
		`You receive a message from the <npc>`
		`The captain of the <npc> hails you`
		`Now that they are disabled, the <npc> sends you a hail`
		# note: if this is used in boarding missions, tweak it a bit to say now that they are boarded
	word
		`: `
	word
		`"Did you cheat? If I learn you cheated, I will be the end of you, little monkey!`
		`"Raaaah... Well, you have beaten me fairly, so I'll pay up..."`
		`"Nicely done! You seem to learn from our encounters well... But next time will be different, I assure you."`
		`"The fight is over! Stop shooting me or you'll blow holes into my ship!`
		`"I surrender. You have indeed lived up to your reputation, I did not stand a chance in this battle. Still, a challenge is a challenge."`
		`"Stop shooting me, you monkey, before my ship breaks apart!`
		`"You seem to learn from our encounters well... next time it will be different."`
		`"Urgent message: we surrender. It is not our way to fight until death, because then there is nothing to be learned through it."`
		`"Is your fleet not too big for this battle? Or do you use superior weaponry?"`
		`"Well done, I guess it is only fair that you be allowed to plunder a few of my outfits...`
	word
		` `
	word
		`For now, here are the agreed <payment>. This is a credit chip that will only be exchanged upon landing. Hopefully the money will allows you to improve your flagship before our next battle..."`
		`I am in no rush to provide you the <payment>, you will receive it when you land but not before."`
		`You will receive <payment> upon landing, captain. Next time I will not underestimate you!"`
		`You must have had an edge! I'm in no condition to give you your payment, but it will be delivered to you upon landing, but don't expect to see us again anytime soon."`
		`You will receive the agreed <payment> upon landing."`
		`Here is your <payment>, captain, to be received upon landing".`
		`Whatever the case, you have earned my blade, and my respect, captain. You will be able to exchange it for <payment> when you land."`
		`We will analyze the fight to make sure you have not cheated. If that is the case, you will receive the <payment> upon landing. If this was a fair fight, you may have gained my respect."`
	word
		"<boarding message>"

substitutions
	"<boarding message>" "(Winning the duel has increased your reputation with the Unfettered. You are in no way allowed to do any more than plundering the ship.)"

mission "Unfettered Challenge [0]"
	job
	repeat
	substitutions
		<payment> "200 thousand credits"
	name `Defeat a young Unfettered captain`
	description `A young Unfettered captain has challenged you into a duel. Disable his ship for <payment>.`
	source
		attributes "unfettered"
	to offer
		has "Unfettered: Prove Your Strength: done"
		"ships: Light Warship" * 4 + "ships: Medium Warship" * 6 + "ships: Heavy Warship" * 12 <= 12
		random < 60
	npc save disable
		government "Hai (Unfettered Challenger)"
		personality disables plunders staying heroic target
		fleet "Sea Scorpion Challenger"
		dialog phrase "unfettered challenger defeated"
	on complete
		payment 200000
		"unfettered challenger defeated" ++

mission "Unfettered Challenge [1A]"
	job
	repeat
	substitutions
		<payment> "500 thousand credits"
	name `Defeat an Unfettered captain`
	description `An Unfettered captain has challenged you into a duel with his escort. Disable his ships for <payment>.`
	source
		attributes "unfettered"
	to offer
		has "Unfettered: Prove Your Strength: done"
		"ships: Light Warship" * 4 + "ships: Medium Warship" * 6 + "ships: Heavy Warship" * 12 <= 24
		random < 20
	npc save disable
		government "Hai (Unfettered Challenger)"
		personality disables plunders staying heroic target
		fleet "Sea Scorpion Challenger" 2
		dialog phrase "unfettered challenger defeated"
	on complete
		payment 500000
		"unfettered challenger defeated" += 2

mission "Unfettered Challenge [1B]"
	job
	repeat
	substitutions
		<payment> "500 thousand credits"
	name `Defeat an Unfettered captain`
	description `An Unfettered captain has challenged you into a duel. Disable his ship for <payment>.`
	source
		attributes "unfettered"
	to offer
		has "Unfettered: Prove Your Strength: done"
		"ships: Light Warship" * 4 + "ships: Medium Warship" * 6 + "ships: Heavy Warship" * 12 <= 24
		random < 20
	npc save disable
		government "Hai (Unfettered Challenger)"
		personality disables plunders staying heroic target
		fleet "Shield Beetle Challenger"
		dialog phrase "unfettered challenger defeated"
	on complete
		payment 500000
		"unfettered challenger defeated" += 2

mission "Unfettered Challenge [2]"
	job
	repeat
	substitutions
		<payment> "1 million credits"
	name `Defeat an old Unfettered captain`
	description `An experienced Unfettered captain has challenged you into a duel with his escort. Disable his ships for <payment>.`
	source
		attributes "unfettered"
	to offer
		has "Unfettered: Prove Your Strength: done"
		"ships: Light Warship" * 4 + "ships: Medium Warship" * 6 + "ships: Heavy Warship" * 12 <= 40
		random < 20
	npc save disable
		government "Hai (Unfettered Challenger)"
		personality disables plunders staying heroic target
		fleet "Shield Beetle Challenger"
		fleet "Sea Scorpion Challenger"
		dialog phrase "unfettered challenger defeated"
	on complete
		payment 1000000
		"unfettered challenger defeated" += 3



# when you board the generic challengers
mission "Unfettered Space Challenge Small"
	minor
	boarding
	repeat
	name "Collect your payment on <destination>"
	description "An Unfettered captain has offered you a payment of <payment> for beating them in battle, land on <destination> to collect it."
	substitutions
		<payment> 200000
		"<boarding message>" "	Do you want to accept the payment offer or plunder the ship? Keep in mind that you are in no way allowed to capture or destroy the ship."
	source
		government "Hai (Unfettered Challenger)"
		not category "Heavy Warship"
	on offer
		dialog phrase "unfettered challenger defeated"
	destination "Darkcloak"
	on complete
		payment 200000

mission "Unfettered Space Challenge Big"
	minor
	boarding
	repeat
	name "Collect your payment on <destination>"
	description "An Unfettered captain has offered you a payment of <payment> for beating them in battle, land on <destination> to collect it."
	substitutions
		<payment> 500000
		"<boarding message>" "Do you want to accept the payment offer or plunder the ship? Keep in mind that you are in no way allowed to capture or destroy the ship."
	source
		government "Hai (Unfettered Challenger)"
	on offer
		dialog phrase "unfettered challenger defeated"
	destination "Darkcloak"
	on complete
		payment 500000



conversation "interrupted duel"
	action
		"unfettered revenge fleet"++
	branch toomuch
		has "unfettered revenge fleet" > 3
	action
		"reputation: Hai (Unfettered)" -= 50
	`The Unfettered authorities of the nearby planet hail you, "Whatever you had in mind you better stop right there if you have hope of maintaining good relations with us. Duels may not be interrupted, under any circumstances. I suggest you leave at once, and we may forgive you for this transgression."`
		decline
	label toomuch
	action
		"reputation: Hai (Unfettered)" <?= -1000
	`The Unfettered authorities of the nearby planet hail you, "You have been warned. We have been patient enough with you, monkey! Now you shall pay."`
	# one can just sell them a JD to get forgiven.


# Kavakai = one with no honor
mission "Death To The Kavakai"
	invisible
	repeat
	deadline 30
	source
		attributes "unfettered"
	to offer
		"unfettered revenge fleet" > 2
	on offer
		"unfettered revenge fleet"--
	on enter
		dialog `An Unfettered fleet launches with you, and you are hailed by one of the ships. "Not only do you dare interrupt a duel, but you dare land on our worlds? We shall teach you respect, Kavakai!"`
	npc kill
		government "Hai (Unfettered)"
		# marked so Hai don't attack them.
		personality staying heroic nemesis unconstrained vindictive marked
		fleet "Sea Scorpion Challenger"
		fleet "Shield Beetle Challenger"
		fleet "Large Unfettered" 2
		fleet "Small Unfettered" 2
	npc kill
		government "Hai (Unfettered)"
		personality staying heroic nemesis unconstrained vindictive marked
		to spawn
			"unfettered revenge fleet" > 3
		fleet "Large Unfettered" 4
	on complete
		"unfettered revenge fleet" += 2

mission "Unfettered Red Blue Sea Scorpion Duel"
	minor
	landing
	invisible
	repeat
	deadline 1
	source
		attributes "unfettered"
	to offer
		random < 8
	to complete
		never
	npc provoke
		government "Hai (Unfettered Blue Challenger)"
		personality disables merciful plunders staying heroic uninterested
		fleet "Sea Scorpion Challenger"
		conversation "interrupted duel"
	npc provoke
		government "Hai (Unfettered Red Challenger)"
		personality disables merciful plunders staying heroic uninterested
		fleet "Sea Scorpion Challenger"
		conversation "interrupted duel"

mission "Unfettered Red Blue Shield Beetle Duel"
	minor
	landing
	invisible
	repeat
	deadline 1
	source
		attributes "unfettered"
	to offer
		random < 4
	to complete
		never
	npc provoke
		government "Hai (Unfettered Blue Challenger)"
		personality disables merciful plunders staying heroic uninterested
		fleet "Shield Beetle Challenger"
		conversation "interrupted duel"
	npc provoke
		government "Hai (Unfettered Red Challenger)"
		personality disables merciful plunders staying heroic uninterested
		fleet "Shield Beetle Challenger"
		conversation "interrupted duel"



# unlocked if you do the mission below
ship "Stag Beetle" "Stag Beetle (Flamer)"
	outfits
		"Sunbeam" 4
		"Flamethrower" 2
		"Korath Detainer"
		"Korath Grab-Strike"
		"Korath Banisher"
		"Bullfrog Anti-Missile" 3
		
		"Liquid Sodium Cooler"
		"Systems Core (Large)" 2
		"Outfits Expansion" 4
		"Wanderer Ramscoop"
		"Jump Drive"
		
		`"Bufaer" Atomic Steering`
		"Afterburner (Comet Class)"
		"Thruster (Lunar Class)"
		
		"Double Plasma Core"
		"Large Biochemical Cell"
		
		"Korath Repeater Rifle" 20
		"Pulse Rifle" 60
		"Dual Pulse Pistols" 10
		"True Unfettered License"
	gun 0 -7 "Korath Detainer"
	gun -22 -102 "Sunbeam"
	gun 22 -102 "Sunbeam"
	gun -34 -68 "Sunbeam"
	gun 34 -68 "Sunbeam"
	gun -49 -38
	gun 49 -38
	gun -61 -14 "Flamethrower"
	gun 61 -14 "Flamethrower"
	turret -51 21.5 "Korath Grab-Strike"
	turret 51 21.5 "Bullfrog Anti-Missile"
	turret -56.5 75 "Korath Banisher"
	turret 56.5 75 "Bullfrog Anti-Missile"
	turret 0 85.5 "Bullfrog Anti-Missile"



# They ask you to sell the weapons you used to defeat them, the chance increases the more duels you win.
mission "Unfettered Bring Fire"
	job
	repeat
	name "Bring 2 Flamethrowers"
	description "The captain you just duelled has seen what fire can do, and they want to learn the secrets behind it. Bring 2 Flamethrowers to them for <payment>."
	source
		attributes "unfettered"
	to offer
		has "outfit (installed): Flamethrower"
		random < "unfettered challenger defeated" * 5
	on offer
		clear "unfettered challenger defeated"
	on complete
		outfit "Flamethrower" -2
		payment 1000000
		dialog `The Unfettered captain is delighted that you were able to give him these 2 Flamethrowers, and give you <payment>. "I shall put them to good use! These seem like they would pair perfectly with our ion weapons." He says, with a grin on his face.`


mission "Unfettered Bring Carnage"
	job
	repeat
	name "Bring 2 Ka'Het Ravager Beams"
	description "The captain you just duelled has seen what the Ka'Het Ravager Beam can do to hull, and they want to learn the secrets behind it. Bring 2 Ka'Het Ravager Beam to them for <payment>."
	source
		attributes "unfettered"
	to offer
		has "outfit (installed): Ka'het Ravager Beam"
		random < "unfettered challenger defeated" * 5
	on offer
		clear "unfettered challenger defeated"
	on complete
		outfit "Ka'het Ravager Beam" -2
		payment 2000000
		dialog `You bring the Ravagers to the captain, and she seems really happy, "Now this is a weapon that does damage to the hull of a ship! The Wanderers have a lot of that, I am sure it will help me pludering! Our legends speak of this weapon... Oh, of course, here are your <payment>."`


mission "Unfettered Bring Repeater"
	job
	repeat
	name "Bring 2 Plasma Repeater"
	description "The captain you just duelled is impressed by the raw amount of heat brought by the Plasma Repeater. Bring 2 Plasma Repeater to them for <payment>."
	source
		attributes "unfettered"
	to offer
		has "outfit (installed): Plasma Repeater"
		random < "unfettered challenger defeated" * 5
	on offer
		clear "unfettered challenger defeated"
	on complete
		outfit "Plasma Repeater" -2
		payment 1500000
		dialog `It does not take long to find the captain, you find him impatiently waiting for you and the Repeaters, "I love exotic weapons! Here are your <payment>, please bring me more variety if you can, I would reward it highly." He says, before heading hastily to his ship, probably to test these weapons.`


mission "Unfettered Bring Particles"
	job
	repeat
	name "Bring 2 Particle Cannons"
	description "The captain you just duelled is interested by the range and damage of the Particle Cannon. Bring 2 to them for <payment>."
	source
		attributes "unfettered"
	to offer
		has "outfit (installed): Particle Cannon"
		random < "unfettered challenger defeated" * 5
	on offer
		clear "unfettered challenger defeated"
	on complete
		outfit "Particle Cannon" -2
		payment 1250000
		dialog `The Unfettered captain greets you with a big smile on his face, "With these particle cannons and my ship's speed, nobody will be able to beat me now! You well deserve the <payment>."`
