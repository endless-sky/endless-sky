test-data "One Earthly Barge"
	category "savegame"
	contents
		pilot Bobbi Bughunter
		date 16 11 3013
		system Sol
		planet Earth
		ship "Star Barge"
			name "Buggy Barge"
			sprite "ship/star barge"
			attributes
				category "Light Freighter"
				cost 190000
				mass 70
				bunks 3
				"cargo space" 50
				drag 2.1
				"engine capacity" 40
				"fuel capacity" 300
				"heat dissipation" 0.8
				hull 1000
				"outfit space" 130
				"required crew" 1
				shields 600
				"turret mounts" 1
				"weapon capacity" 20
			outfits
				"X1700 Ion Thruster"
				"X1200 Ion Steering"
				Hyperdrive
				"Anti-Missile Turret"
				"D14-RN Shield Generator"
				"nGVF-BB Fuel Cell"
				"LP036a Battery Pack"
			crew 1
			fuel 300
			shields 600
			hull 1000
			engine -9 38 1
			engine 9 38 1
			turret 0 -8 "Anti-Missile Turret"
			leak leak 60 50
			explode "tiny explosion" 10
			explode "small explosion" 10
			system Sol
			planet Earth
		account
			credits 0
			score 400
			history
		mission "%TEST%: Switch"
			landing
			on offer
				take ship "Star Barge"
				give ship "Sparrow" "The Sparrow"
					id "ship: sparrow"
		mission "%TEST%: Check sparrow"
			landing
			on offer
				take ship "Sparrow" "The Sparrow"
					id "ship: sparrow"
				payment 10

mission "%TEST%: Switch"
mission "%TEST%: Check sparrow"

test "Checking for a gifted ship"
	status active
	description "Test losing a freighter, getting a sparrow and then verify the player has said (named) sparrow, after reloading the save."
		# Create/inject the savegame and load it.
		inject "One Earthly Barge"
		call "Load First Savegame"
		call "Wait 10 steps"
		call "Depart"
		call "Land"
		# Reload this to make sure the UUID is well stored into the savefile.
		call "Open Menu"
		call "Load First Savegame"
		call "Depart"
		assert
			"credits" == 10
			"ships: Light Freighter" == 0
			"ships: Interceptor" == 0
			"%TEST%: Switch: offered" == 1
			"%TEST%: Check sparrow: offered" == 1


test-data "One Specific Barge"
	category "savegame"
	contents
		pilot Bobbi Bughunter
		date 16 11 3013
		system Sol
		planet Earth
		ship "Star Barge"
			name "Buggy Barge"
			sprite "ship/star barge"
			attributes
				category "Light Freighter"
				cost 190000
				mass 70
				bunks 3
				"cargo space" 50
				drag 2.1
				"engine capacity" 40
				"fuel capacity" 300
				"heat dissipation" 0.8
				hull 1000
				"outfit space" 130
				"required crew" 1
				shields 600
				"turret mounts" 1
				"weapon capacity" 20
			outfits
				"X1700 Ion Thruster"
				"X1200 Ion Steering"
				Hyperdrive
				"Anti-Missile Turret"
				"D14-RN Shield Generator"
				"nGVF-BB Fuel Cell"
				"LP036a Battery Pack"
			crew 1
			fuel 300
			shields 600
			hull 1000
			engine -9 38 1
			engine 9 38 1
			turret 0 -8 "Anti-Missile Turret"
			leak leak 60 50
			explode "tiny explosion" 10
			explode "small explosion" 10
			system Sol
			planet Earth
		ship "Star Barge"
			name "Buggy Barge"
			sprite "ship/star barge"
			attributes
				category "Light Freighter"
				cost 190000
				mass 70
				bunks 3
				"cargo space" 50
				drag 2.1
				"engine capacity" 40
				"fuel capacity" 300
				"heat dissipation" 0.8
				hull 1000
				"outfit space" 130
				"required crew" 1
				shields 600
				"turret mounts" 1
				"weapon capacity" 20
			outfits
				"Blaster Turret"
				"nGVF-BB Fuel Cell"
				"LP036a Battery Pack"
				"D14-RN Shield Generator"
				"Laser Rifle"
				"Chipmunk Plasma Thruster"
				"Chipmunk Plasma Steering"
				"Hyperdrive"
			crew 1
			fuel 300
			shields 600
			hull 1000
			engine -9 38 1
			engine 9 38 1
			turret 0 -8
			leak leak 60 50
			explode "tiny explosion" 10
			explode "small explosion" 10
			system "Tania Australis"
			planet Ingot
		account
			credits 0
			score 400
			history
		mission "%TEST%: Switch"
			landing
			on offer
				# the ship is not here
				take ship "Star Barge (Armed)"
					"requires outfits"
		mission "%TEST%: Switch 2"
			landing
			on offer
				# incorrect ship name
				take ship "Star Barge (Armed)" "Well defended"
					unconstrained
		mission "%TEST%: Switch 3"
			landing
			on offer
				# correct
				take ship "Star Barge (Armed)"
					unconstrained

mission "%TEST%: Switch 2"
mission "%TEST%: Switch 3"

test "Taking right ship variant and unconstrained"
	status active
	description "Test taking variants ships with the unconstrained keyword and not, and receiving sparrows."
		# Create/inject the savegame and load it.
		inject "One Specific Barge"
		call "Load First Savegame"
		call "Wait 10 steps"
		call "Depart"
		# we only lost the far away barge, because otherwise we would have more sparrows.
		assert
			"ships: Light Freighter" == 1
			"ships: Interceptor" == 2
			"%TEST%: Switch: offered" == 0
			"%TEST%: Switch 2: offered" == 0
			"%TEST%: Switch 3: offered" == 1
